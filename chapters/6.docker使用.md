---
title: dockeråŸºæœ¬ä½¿ç”¨
date: '2022/10/9 13:17:57'
top_img: 'https://pic.hycbook.com/i/hexo/post_imgs/è•¾å§†5.webp'
cover: 'https://pic.hycbook.com/i/hexo/post_cover/è•¾å§†5.webp'
categories:
  - common
tags:
  - docker
  - neo4j
  - å›¾æ•°æ®åº“
abbrlink: 50622
---

---



# docker

> [dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
>
> [Docker å¿«é€Ÿå…¥é—¨](https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP)

## dockeræ˜¯ä»€ä¹ˆ

Docker æ˜¯ä¸€ä¸ªåº”ç”¨æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²çš„å·¥å…·

ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªè½»é‡çš„è™šæ‹Ÿæœºï¼Œå®ƒåªè™šæ‹Ÿä½ è½¯ä»¶éœ€è¦çš„è¿è¡Œç¯å¢ƒï¼Œå¤šä½™çš„ä¸€ç‚¹éƒ½ä¸è¦

è€Œæ™®é€šè™šæ‹Ÿæœºåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´è€Œåºå¤§çš„ç³»ç»Ÿï¼ŒåŒ…å«å„ç§ä¸ç®¡ä½ è¦ä¸è¦çš„è½¯ä»¶

>è·Ÿæ™®é€šè™šæ‹Ÿæœºçš„å¯¹æ¯”

| ç‰¹æ€§   | æ™®é€šè™šæ‹Ÿæœº                                                   | Docker                                               |
| ------ | ------------------------------------------------------------ | ---------------------------------------------------- |
| è·¨å¹³å° | é€šå¸¸åªèƒ½åœ¨æ¡Œé¢çº§ç³»ç»Ÿè¿è¡Œï¼Œä¾‹å¦‚ Windows/Macï¼Œæ— æ³•åœ¨ä¸å¸¦å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ | æ”¯æŒçš„ç³»ç»Ÿéå¸¸å¤šï¼Œå„ç±» windows å’Œ Linux éƒ½æ”¯æŒ       |
| æ€§èƒ½   | æ€§èƒ½æŸè€—å¤§ï¼Œå†…å­˜å ç”¨é«˜ï¼Œå› ä¸ºæ˜¯æŠŠæ•´ä¸ªå®Œæ•´ç³»ç»Ÿéƒ½è™šæ‹Ÿå‡ºæ¥äº†     | æ€§èƒ½å¥½ï¼Œåªè™šæ‹Ÿè½¯ä»¶æ‰€éœ€è¿è¡Œç¯å¢ƒï¼Œæœ€å¤§åŒ–å‡å°‘æ²¡ç”¨çš„é…ç½® |
| è‡ªåŠ¨åŒ– | éœ€è¦æ‰‹åŠ¨å®‰è£…æ‰€æœ‰ä¸œè¥¿                                         | ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²å¥½æ‰€éœ€ç¯å¢ƒ                     |
| ç¨³å®šæ€§ | ç¨³å®šæ€§ä¸é«˜ï¼Œä¸åŒç³»ç»Ÿå·®å¼‚å¤§                                   | ç¨³å®šæ€§å¥½ï¼Œä¸åŒç³»ç»Ÿéƒ½ä¸€æ ·éƒ¨ç½²æ–¹å¼                     |

> æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²

**æ‰“åŒ…**ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…

**åˆ†å‘**ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…

**éƒ¨ç½²**ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows/Mac/Linux

## dockerå®‰è£…

$$
dockerå®¹å™¨ = é•œåƒ + å¯è¯»å±‚
$$

å®¹å™¨æ˜¯ç”±é•œåƒå®ä¾‹åŒ–è€Œæ¥ï¼Œç®€å•æ¥è¯´ï¼Œé•œåƒæ˜¯æ–‡ä»¶ï¼Œå®¹å™¨æ˜¯è¿›ç¨‹

**å®¹å™¨æ˜¯åŸºäºé•œåƒåˆ›å»ºçš„ï¼Œå³å®¹å™¨ä¸­çš„è¿›ç¨‹ä¾èµ–äºé•œåƒä¸­çš„æ–‡ä»¶**

docker çš„é•œåƒæ¦‚å¿µç±»ä¼¼è™šæ‹Ÿæœºçš„é•œåƒã€‚æ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼Œä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬è¿è¡Œå®¹å™¨æ‰€éœ€çš„æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºæ–°çš„å®¹å™¨

é•œåƒè¿è¡Œèµ·æ¥å°±æ˜¯å®¹å™¨ï¼Œå®¹å™¨æœåŠ¡è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒåŸºäºåŸå§‹é•œåƒåšäº†æ”¹å˜ï¼Œæ¯”å¦‚å®‰è£…äº†ç¨‹åºï¼Œæ·»åŠ äº†æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æäº¤å›å» (commit)æˆä¸ºé•œåƒ

dockerå®‰è£…åˆ†ä¸ºå®‰è£…åŒ…å’Œå‘½ä»¤è¡Œä¸¤ç§

{% tabs dockerå®‰è£… %}

<!-- tab win11å®‰è£…åŒ… -->

ä¸‹è½½[docker](https://www.docker.com/products/docker-desktop/)å®‰è£…åŒ…ï¼ŒæŒ‰ç…§æŒ‡ç¤ºå®‰è£…å³å¯

windowséœ€è¦æ‰“å¼€`å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½`ä¸‹çš„`Hyper-V`ã€`å®¹å™¨`å’Œ`é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»Ÿ`é€‰é¡¹

å®‰è£…å®Œè¦æ‰“å¼€`Docker Desktop`è½¯ä»¶ï¼Œæ‰“å¼€ä¼šå¯åŠ¨å¼•æ“ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨docker

é‡è¦ï¼šæ‰“å¼€`Docker Desktop`è½¯ä»¶ï¼Œæ‰“å¼€`Settings`ä¸‹çš„`Resources`ï¼Œé€‰æ‹©`Advanced`ä¸‹çš„`Disk image location`ï¼Œé€‰æ‹©åˆé€‚çš„æ–‡ä»¶å¤¹å­˜æ”¾dockerçš„é•œåƒå’Œå®¹å™¨ï¼Œæ³¨æ„åæœŸå®¹å™¨å¤šçš„è¯ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å¾ˆå ç©ºé—´çš„

<!-- endtab -->

<!-- tab centos7å‘½ä»¤è¡Œ -->

```sh
curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
```

> é…ç½®é•œåƒåŠ é€Ÿ

è¿›å…¥[é˜¿é‡Œäº‘](https://cr.console.aliyun.com/)ï¼Œç™»é™†åç‚¹å‡»å·¦ä¾§çš„é•œåƒåŠ é€Ÿï¼Œç”Ÿæˆè‡ªå·±çš„é•œåƒåŠ é€Ÿåœ°å€

æ‰§è¡Œé˜¿é‡Œäº‘æ¨èçš„ç»ˆç«¯å‘½ä»¤ï¼Œå³å¯æ›´æ–°dockerçš„é•œåƒæºä¸ºé˜¿é‡Œäº‘é•œåƒ

```sh
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://xk5lrhin.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

> ä»£ç†é…ç½®

1. ä¸ºdockeræœåŠ¡åˆ›å»ºä¸€ä¸ªå†…åµŒçš„systemdç›®å½•

   ```sh
   mkdir -p /etc/systemd/system/docker.service.d
   ```

2. åˆ›å»º`/etc/systemd/system/docker.service.d/http-proxy.conf`æ–‡ä»¶ï¼Œå¹¶æ·»åŠ HTTP_PROXYç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­[proxy-addr]å’Œ[proxy-port]åˆ†åˆ«æ”¹æˆå®é™…æƒ…å†µçš„ä»£ç†åœ°å€å’Œç«¯å£

   ```sh
   [Service]
   Environment="HTTP_PROXY=http://192.168.4.xx:xx" "HTTPS_PROXY=http://192.168.4.xx:xx"
   ```

3. å¦‚æœè¿˜æœ‰å†…éƒ¨çš„ä¸éœ€è¦ä½¿ç”¨ä»£ç†æ¥è®¿é—®çš„Docker registriesï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ¶å®šNO_PROXYç¯å¢ƒå˜é‡

   ```sh
   [Service]
   Environment="HTTP_PROXY=http://192.168.4.xx:xx" "HTTPS_PROXY=http://192.168.4.xx:xx" "NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com"
   ```

4. æ›´æ–°é…ç½®å¹¶é‡å¯DockeræœåŠ¡

   ```sh
   systemctl daemon-reload
   systemctl restart docker
   ```

<!-- endtab -->

{% endtabs %}

> åŠ é€Ÿæ ¼å¼ï¼š"registry-mirrors": ["https://registry.docker-cn.com"]

| é•œåƒåŠ é€Ÿå™¨          | é•œåƒåŠ é€Ÿå™¨åœ°å€                       |
| ------------------- | ------------------------------------ |
| Docker ä¸­å›½å®˜æ–¹é•œåƒ | https://registry.docker-cn.com       |
| DaoCloud é•œåƒç«™     | http://f1361db2.m.daocloud.io        |
| Azure ä¸­å›½é•œåƒ      | https://dockerhub.azk8s.cn           |
| ç§‘å¤§é•œåƒç«™          | https://docker.mirrors.ustc.edu.cn   |
| é˜¿é‡Œäº‘              | https://ud6340vz.mirror.aliyuncs.com |
| ä¸ƒç‰›äº‘              | https://reg-mirror.qiniu.com         |
| ç½‘æ˜“äº‘              | https://hub-mirror.c.163.com         |
| è…¾è®¯äº‘              | https://mirror.ccs.tencentyun.com    |

## åŸºæœ¬å‘½ä»¤å­¦ä¹ 

> åŸºæœ¬å‘½ä»¤

```sh
# æŸ¥çœ‹ç‰ˆæœ¬å·
docker version

# å¯åŠ¨docker
systemctl start docker
# å…³é—­docker
systemctl stop docker
# é‡å¯docker
systemctl restart docker

# dockerè®¾ç½®éšæœåŠ¡å¯åŠ¨è€Œè‡ªå¯åŠ¨
systemctl enable docker

# æŸ¥çœ‹docker è¿è¡ŒçŠ¶æ€
systemctl status docker

# æŸ¥çœ‹volumeåˆ—è¡¨
docker volume ls

# æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨
docker network ls
```

> é•œåƒ

Dockeré»˜è®¤æ‹‰å–çš„æ¶æ„æ˜¯ä¸ä¸»æœºçš„æ¶æ„ç›¸åŒï¼Œå½“ä½ åœ¨ä¸€ä¸ªç‰¹å®šçš„æ¶æ„ä¸Šè¿è¡ŒDockerå‘½ä»¤æ—¶ï¼ŒDockerå°†è‡ªåŠ¨å°è¯•æ‹‰å–ä¸è¯¥æ¶æ„åŒ¹é…çš„é•œåƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨x86æ¶æ„çš„ä¸»æœºä¸Šè¿è¡ŒDockerå‘½ä»¤ï¼ŒDockerå°†å°è¯•æ‹‰å–x86æ¶æ„çš„é•œåƒ

è¿™æ„å‘³ç€Dockerä¼šè‡ªåŠ¨é€‚é…ä¸»æœºçš„æ¶æ„ï¼Œå¹¶æ‹‰å–ç›¸åº”çš„é•œåƒä¾›ä½¿ç”¨ã€‚å¦‚æœéœ€è¦æŒ‡å®šæ¶æ„ï¼Œå¯ä»¥åŠ ä¸Š`--platform=arm64`å‚æ•°

```sh
# æŸ¥çœ‹æœ¬åœ°é•œåƒ
docker images

# æœç´¢é•œåƒ
docker search neo4j
# æ‹‰å–é•œåƒ  å¦‚æœéœ€è¦æŒ‡å®šæ¶æ„ï¼Œå¯ä»¥åŠ ä¸Š`--platform=arm64`å‚æ•°
docker pull é•œåƒå:tag

# åˆ é™¤é•œåƒ ------å½“å‰é•œåƒæ²¡æœ‰è¢«ä»»ä½•å®¹å™¨ä½¿ç”¨æ‰å¯ä»¥åˆ é™¤
docker rmi -f é•œåƒå/é•œåƒID
# åˆ é™¤å¤šä¸ª å…¶é•œåƒIDæˆ–é•œåƒç”¨ç”¨ç©ºæ ¼éš”å¼€å³å¯
docker rmi -f é•œåƒå/é•œåƒID é•œåƒå/é•œåƒID

# ä¿å­˜é•œåƒï¼Œå°†æˆ‘ä»¬çš„é•œåƒä¿å­˜ä¸ºtarå‹ç¼©æ–‡ä»¶ï¼Œè¿™æ ·æ–¹ä¾¿é•œåƒè½¬ç§»å’Œä¿å­˜
# ç„¶åå¯ä»¥åœ¨ä»»ä½•ä¸€å°å®‰è£…äº†dockerçš„æœåŠ¡å™¨ä¸ŠåŠ è½½è¿™ä¸ªé•œåƒ
docker save é•œåƒå/é•œåƒID -o é•œåƒä¿å­˜åœ¨å“ªä¸ªä½ç½®ä¸åå­—
docker save -o my_ubuntu_v3.tar runoob/ubuntu:v3

# åŠ è½½é•œåƒ
docker load --input my_ubuntu_v3.tar

# é•œåƒé‡å‘½å
docker tag <IMAGE_ID> <NEW_REPOSITORY>:<TAG>
```

> å®¹å™¨

```sh
# åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ï¼Œä¸ä¼šç«‹å³è¿è¡Œ
docker create  --name my_container nginx:latest
# åˆ›å»ºå’Œå¯åŠ¨çš„ç»„åˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°å®¹å™¨å¹¶ç«‹å³å¯åŠ¨å®ƒï¼Œ-dè¡¨ç¤ºåå°
docker run --name my_container -d nginx:latest

# å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨
docker container start
# åœæ­¢å®¹å™¨
docker stop å®¹å™¨IDæˆ–è€…å®¹å™¨å
# é‡å¯å®¹å™¨
docker restart å®¹å™¨IDæˆ–è€…å®¹å™¨å

# åˆ—å‡ºæ‰€æœ‰åœ¨è¿è¡Œçš„å®¹å™¨ä¿¡æ¯
docker ps
# æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰å®¹å™¨
docker ps -a

# åˆ é™¤æŒ‡å®šå®¹å™¨
docker rm -f <container_id0> <container_id1>
# åˆ é™¤æœªå¯åŠ¨æˆåŠŸçš„å®¹å™¨
docker rm $(docker ps -a|grep Created|awk '{print $1}')
# åˆ é™¤æ‰€æœ‰æœªè¿è¡Œçš„å®¹å™¨
docker rm $(docker ps -a|grep Created|awk '{print $1}')

# å®¹å™¨é‡å‘½å
docker rename CONTAINER NEW_NAME
```

é•œåƒæ‰“åŒ…å·¥å…·  Buildpacksã€Dockerfile

[Docker, Dockerfile, å’ŒDocker ComposeåŒºåˆ« | Baeldung](https://www.baeldung.com/ops/docker-dockerfile-docker-compose)

Docker Composeå…è®¸æˆ‘ä»¬å®šä¹‰å®¹å™¨å…±äº«çš„å…±åŒå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§å®šä¹‰ä¸€ä¸ªå·ï¼Œç„¶åæŠŠå®ƒæŒ‚åœ¨æ¯ä¸ªå®¹å™¨é‡Œï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥å…±äº«ä¸€ä¸ªå…±åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç”¨æ¥é€šä¿¡çš„ç½‘ç»œã€‚

Docker Composeåªæ˜¯ä¸€ä¸ªåè°ƒå¤šä¸ªå®¹å™¨çš„å·¥å…·ã€‚å…¶ä»–é€‰æ‹©åŒ…æ‹¬Kubernetesã€Openshiftå’ŒApache Mesos

[Dockerå®¹å™¨è¿ç§»åˆ°å…¶ä»–æœåŠ¡å™¨çš„5ç§æ–¹æ³•è¯¦è§£_docker](https://www.anquanclub.cn/5985.html)

## ç›®å½•æŒ‚è½½

- ä½¿ç”¨ Docker è¿è¡Œåï¼Œæˆ‘ä»¬æ”¹äº†é¡¹ç›®ä»£ç ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°`build`å’Œ`run`ï¼Œå¾ˆæ˜¯éº»çƒ¦
- å®¹å™¨é‡Œé¢äº§ç”Ÿçš„æ•°æ®ï¼Œä¾‹å¦‚ log æ–‡ä»¶ï¼Œæ•°æ®åº“å¤‡ä»½æ–‡ä»¶ï¼Œå®¹å™¨åˆ é™¤åå°±ä¸¢å¤±äº†

> ç›®å½•æŒ‚è½½è§£å†³ä»¥ä¸Šé—®é¢˜

- `bind mount` ç›´æ¥æŠŠå®¿ä¸»æœºç›®å½•æ˜ å°„åˆ°å®¹å™¨å†…ï¼Œé€‚åˆæŒ‚ä»£ç ç›®å½•å’Œé…ç½®æ–‡ä»¶ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š
- `volume` ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†ï¼Œåˆ›å»ºåœ¨å®¿ä¸»æœºï¼Œæ‰€ä»¥åˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±ï¼Œå®˜æ–¹æ¨èï¼Œæ›´é«˜æ•ˆï¼ŒLinux æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆå­˜å‚¨æ•°æ®åº“æ•°æ®ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š
- `tmpfs mount` é€‚åˆå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ï¼Œå­˜å®¿ä¸»æœºå†…å­˜ä¸­ã€‚ä¸å¯å¤šå®¹å™¨å…±äº«

> æ¼”ç¤º

```cmd
# bind mount æ–¹å¼
docker run -p 8080:8080 --name test-hello -v D:/code:/app -d test:v1

# volume æ–¹å¼
docker run -p 8080:8080 --name test-hello -v db-data:/app -d test:v1
```

## å¤šå®¹å™¨é€šä¿¡

### è™šæ‹Ÿç½‘ç»œ

è¦æƒ³å¤šå®¹å™¨ä¹‹é—´äº’é€šï¼Œä» Web å®¹å™¨è®¿é—® Redis å®¹å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä»–ä»¬æ”¾åˆ°åŒä¸ªç½‘ç»œä¸­å°±å¯ä»¥äº†

åˆ›å»ºä¸€ä¸ªåä¸º`test-net`çš„ç½‘ç»œï¼š

```
docker network create test-net
```

è¿è¡Œ Redis åœ¨ `test-net` ç½‘ç»œä¸­ï¼Œåˆ«å`redis`

```cmd
# network-aliasæŒ‡çš„æ˜¯ç½‘ç»œçš„åˆ«å
docker run -d --name redis --network redis-net --network-alias redis redis:latest
```

ä½¿ç”¨æ—¶urlå¡«å†™`redisï¼š//redis:6379`

> è¿è¡Œ Web é¡¹ç›®ï¼Œä½¿ç”¨åŒä¸ªç½‘ç»œ

```cmd
docker run -p 8080:8080 --name test -v D:/test:/app --network redis-net -d test:v0
```

### Docker-Compose

å‡è®¾è¿è¡Œäº†ä¸¤ä¸ªå®¹å™¨ï¼šWeb é¡¹ç›® + Redis

å¦‚æœé¡¹ç›®ä¾èµ–æ›´å¤šçš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†çš„å®¹å™¨å°±æ›´åŠ å¤šï¼Œæ¯ä¸ªéƒ½è¦å•ç‹¬é…ç½®è¿è¡Œï¼ŒæŒ‡å®šç½‘ç»œ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker-compose æŠŠé¡¹ç›®çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œä¸€é”®è¿è¡Œ

> å®‰è£… Docker Compose

- å¦‚æœä½ æ˜¯å®‰è£…çš„æ¡Œé¢ç‰ˆ Dockerï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ï¼Œå·²ç»åŒ…å«äº†
- å¦‚æœæ˜¯æ²¡å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ç‰ˆ Dockerï¼Œä½ éœ€è¦å•ç‹¬å®‰è£… [å®‰è£…æ–‡æ¡£](https://docs.docker.com/compose/install/#install-compose-on-linux-systems)
- è¿è¡Œ`docker-compose`æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ

> [ç¼–å†™è„šæœ¬](https://docs.docker.com/compose/)

è¦æŠŠé¡¹ç›®ä¾èµ–çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª`docker-compose.yml`æ–‡ä»¶ï¼Œæè¿°ä¾èµ–å“ªäº›æœåŠ¡

å®¹å™¨é»˜è®¤æ—¶é—´ä¸æ˜¯åŒ—äº¬æ—¶é—´ï¼Œå¢åŠ  TZ=Asia/Shanghai å¯ä»¥æ”¹ä¸ºåŒ—äº¬æ—¶é—´

```yaml
version: "3.7"

services:
  app:
    build: ./  # æˆ–è€…ç›´æ¥ä½¿ç”¨é•œåƒ  image: narutohyc/ubuntu:v0
    ports:
      - 80:8080
    volumes:
      - ./:/app
    environment:
      - TZ=Asia/Shanghai
  redis:
    image: redis:5.0.13
    volumes:
      - redis:/data
    environment:
      - TZ=Asia/Shanghai

volumes:
  redis:
```

åœ¨`docker-compose.yml` æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š`docker-compose up`å°±å¯ä»¥è·‘èµ·æ¥äº†ï¼Œ[æ–‡æ¡£åœ¨è¿™](https://docs.docker.com/compose/reference/up/)

åœ¨åå°è¿è¡Œåªéœ€è¦åŠ ä¸€ä¸ª -d å‚æ•°`docker-compose up -d`

| åŠ¨ä½œ | å‘½ä»¤ |
| ---- | ---- |
| æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ | `docker-compose ps` |
| åœæ­¢è¿è¡Œ | `docker-compose stop` |
| é‡å¯ | `docker-compose restart` |
| é‡å¯å•ä¸ªæœåŠ¡ | `docker-compose restart service-name` |
| è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œ | `docker-compose exec service-name sh` |
| æŸ¥çœ‹å®¹å™¨è¿è¡Œlog | `docker-compose logs [service-name]` |





## hello world

> åˆ›å»ºdockfileï¼Œæ–°å»ºä¸€ä¸ª`Dockerfile`æ–‡ä»¶

```cmd
# ä½¿ç”¨åŸºç¡€é•œåƒï¼Œé€‰æ‹©é€‚åˆæ‚¨çš„ç¯å¢ƒ
FROM ubuntu:20.04

# å®‰è£…ä¾èµ–åº“å’Œå·¥å…·
RUN apt update
RUN apt-get install -y wget

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app
```

> æ„å»ºé•œåƒï¼Œåœ¨`Dockerfile`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ**-t**åé¢è·Ÿçš„æ˜¯é•œåƒåå’Œç‰ˆæœ¬ï¼Œè¿™é‡Œä¼šæ„å»ºä¸€ä¸ª`fastchat`é•œåƒï¼Œç‰ˆæœ¬å·ä¸º`v0`ï¼Œ

```cmd
docker build -t fastchat:v0 .
```

å¦‚æœå‡ºç°ç½‘ç»œé—®é¢˜ï¼Œéœ€è¦é…ç½®ä»£ç†ï¼Œå¯ä»¥å¸¦ä¸Š`--build-arg`å‚æ•°

```cmd
docker build -t fastchat:v0 --build-arg http_proxy=http://192.168.0.xx:xx --build-arg https_proxy=http://192.168.0.xx:xx .
```

å¦‚æœéœ€è¦æŒ‡å®šdockfileæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`-f`å‚æ•°

```cmd
docker build -f Q:\pyCharmWS\chatgpts\dockfiles\Dockerfile-ubuntu -t ubuntu:v0 . 
```

é™¤äº†è‡ªå·±å†™dockfileï¼Œè¿˜å¯ä»¥ä½¿ç”¨`docker pull`æ‹‰å–ç°æˆçš„é•œåƒ

> æŸ¥çœ‹é•œåƒåˆ—è¡¨

```cmd
docker images

REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
fastchat     v0        20ee81939779   20 seconds ago   115MB
```

> å¯åŠ¨é•œåƒ

```cmd
docker run -itd -p 8080:80 --name ubuntu-test fastchat:v0

>>> 918a3b2ccc42436e01c5033021ba97d5bd4c56df48b2c549bf01855d9979333c
```

`docker run -itd`è¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶å…è®¸ä¸å®¹å™¨è¿›è¡Œäº¤äº’ï¼ŒåŒæ—¶ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯

å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£

`--name ubuntu-test`ç”¨äºæŒ‡å®šå®¹å™¨çš„åç§°ä¸º`ubuntu-testï¼Œè¿”å›ä¸€ä¸ªå®¹å™¨id

å¦‚æœå·²æ‰§è¡Œå°±é€€å‡º'Exit(0)'ï¼Œå¯ä»¥åŠ ä¸Šå‚æ•°`--entrypoint=/bin/bash`ï¼Œè¿™é‡Œä¼šè‡ªåŠ¨é€€å‡ºæ˜¯å› ä¸ºDockerå®¹å™¨åå°è¿è¡Œï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤(æ¯”å¦‚è¿è¡Œtopï¼Œtail)å°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„



> æŸ¥çœ‹å®¹å™¨åˆ—è¡¨

```cmd
docker ps

CONTAINER ID   IMAGE         COMMAND       CREATED          STATUS          PORTS     NAMES
918a3b2ccc42   fastchat:v0   "/bin/bash"   20 seconds ago   Up 19 seconds             ubuntu-test
```

`CONTAINER ID`æŒ‡çš„æ˜¯å®¹å™¨ID

> è¿›å…¥å®¹å™¨


{% tabs å……åˆ†æ¡ä»¶ %}

<!-- tab execæ–¹å¼ -->

```cmd
docker exec -it ubuntu-test bash
```

è¾“å…¥`exit`é€€å‡ºï¼Œcontaineræ˜¯ä¸ä¼šè¢«å…³é—­çš„

<!-- endtab -->


<!-- tab attachæ–¹å¼ -->

```cmd
docker attach ubuntu-test
```

ä½¿ç”¨å¿«æ·é”®é€€å‡ºï¼šæŒ‰ä¸‹é”®ç›˜ä¸Šçš„`Ctrl + P`ï¼Œç„¶åæŒ‰ä¸‹`Ctrl + Q`ï¼Œcontaineræ˜¯ä¸ä¼šè¢«å…³é—­çš„

æˆ–è€…è¾“å…¥`exit`é€€å‡ºï¼Œcontaineræ˜¯**ä¼š**è¢«å…³é—­çš„

è¿™ä¸ªç»„åˆé”®å¯ä»¥åˆ†ç¦»ç»ˆç«¯ä¸å®¹å™¨çš„è¿æ¥ï¼Œä½†ä¸ä¼šåœæ­¢å®¹å™¨çš„è¿è¡Œï¼Œå°†è¿”å›åˆ°å®¿ä¸»æœºçš„ç»ˆç«¯ï¼Œè€Œå®¹å™¨ä¼šç»§ç»­åœ¨åå°è¿è¡Œ

<!-- endtab -->

{% endtabs %}


> åœæ­¢å®¹å™¨

```cmd
docker stop ubuntu-test
```

å½“æ‚¨æ‰§è¡Œ`docker stop`å‘½ä»¤åœæ­¢å®¹å™¨åï¼Œå®¹å™¨çš„åç§°å¯èƒ½ä»ç„¶ä¿ç•™åœ¨Dockerä¸­ã€‚å¦‚æœæ‚¨å°è¯•ä½¿ç”¨ç›¸åŒçš„å®¹å™¨åç§°å†æ¬¡è¿è¡Œå®¹å™¨ï¼Œä¼šå‡ºç°"é‡å"çš„é”™è¯¯

```cmd
Q:\pyCharmWS\chatgpts\dockfiles>docker run -itd --name ubuntu-test fastchat:v0
docker: Error response from daemon: Conflict. The container name "/ubuntu-test" is already in use by container "918a3b2ccc42436e01c5033021ba97d5bd4c56df48b2c549bf01855d9979333c". You have to remove (or rename) that container to be able to reuse that name.
See 'docker run --help'.
```

è¿™æ˜¯å› ä¸ºDockerè¦æ±‚å®¹å™¨åç§°åœ¨ç»™å®šçš„å‘½åç©ºé—´ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å½“æ‚¨åœæ­¢å®¹å™¨æ—¶ï¼Œè¯¥å®¹å™¨çš„åç§°ä¸ä¼šç«‹å³ä»Dockerä¸­åˆ é™¤ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æŸ¥çœ‹å·²åœæ­¢å®¹å™¨çš„çŠ¶æ€å’Œæ—¥å¿—ç­‰ä¿¡æ¯

è¿™æ—¶å€™å¯ä»¥`æ›´æ”¹åŸæ¥å®¹å™¨çš„åç§°`æˆ–`åˆ é™¤å·²åœæ­¢çš„å®¹å™¨`

* docker rename ubuntu-old ubuntu-test

  ```cmd
  Q:\pyCharmWS\chatgpts\dockfiles>docker ps -a
  CONTAINER ID   IMAGE         COMMAND       CREATED          STATUS                        PORTS     NAMES
  918a3b2ccc42   fastchat:v0   "/bin/bash"   41 minutes ago   Exited (130) 11 minutes ago             ubuntu-test
  ```

* docker rm ubuntu-test

> é‡å¯å®¹å™¨

```cmd
docker restart ubuntu-test
```

> å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼Œä»¥ä¾¿ç¨åå†æ¬¡ä½¿ç”¨æˆ–ä¸å…¶ä»–äººå…±äº«

è¦å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼Œå¯ä»¥ä½¿ç”¨`docker commit`å‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯ä¿å­˜å®¹å™¨ä¸ºé•œåƒçš„æ­¥éª¤ï¼š

1. ç¡®ä¿æ‚¨çš„å®¹å™¨å¤„äºåœæ­¢çŠ¶æ€ã€‚å¦‚æœå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œè¯·å…ˆåœæ­¢å®ƒï¼š

   ```cmd
   docker stop <container_name_or_id>
   ```

2. ä½¿ç”¨`docker commit`å‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒã€‚åœ¨å‘½ä»¤ä¸­æŒ‡å®šå®¹å™¨çš„åç§°æˆ–IDä»¥åŠè¦ä¸ºæ–°é•œåƒæŒ‡å®šçš„åç§°å’Œæ ‡ç­¾ï¼š

   ```cmd
   docker commit <container_name_or_id> <new_image_name:tag>
   ```

   ä¾‹å¦‚ï¼š

   ```cmd
   docker commit mycontainer myimage:v1
   ```

   è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º`myimage`ï¼Œæ ‡ç­¾ä¸º`v1`çš„æ–°é•œåƒ

3. ç­‰å¾…`docker commit`å‘½ä»¤å®Œæˆï¼Œå®ƒä¼šå°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå’Œå…ƒæ•°æ®ä¿å­˜ä¸ºæ–°çš„é•œåƒã€‚ä¸€æ—¦å®Œæˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`docker images`å‘½ä»¤æŸ¥çœ‹æ–°åˆ›å»ºçš„é•œåƒ

ç°åœ¨ï¼Œæ‚¨å·²ç»å°†å®¹å™¨ä¿å­˜ä¸ºæ–°çš„é•œåƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥é•œåƒåˆ›å»ºæ–°çš„å®¹å™¨ï¼Œæˆ–å°†å…¶æ¨é€åˆ°é•œåƒä»“åº“ä»¥ä¾›å…¶ä»–äººä½¿ç”¨

è¯·æ³¨æ„ï¼Œä½¿ç”¨`docker commit`å‘½ä»¤ä¿å­˜å®¹å™¨ä¸ºé•œåƒæ—¶ï¼Œé•œåƒå°†åŒ…å«å®¹å™¨ä¸­å½“å‰çš„æ–‡ä»¶ç³»ç»ŸçŠ¶æ€å’Œé…ç½®ã€‚è¿™æ„å‘³ç€å¦‚æœå®¹å™¨ä¸­æœ‰ä»»ä½•ä¸å¿…è¦çš„æ–‡ä»¶æˆ–æ•æ„Ÿä¿¡æ¯ï¼Œå®ƒä»¬ä¹Ÿä¼šåŒ…å«åœ¨ä¿å­˜çš„é•œåƒä¸­ã€‚å› æ­¤ï¼Œåœ¨ä¿å­˜å®¹å™¨ä¹‹å‰ï¼Œæœ€å¥½ç¡®ä¿å®¹å™¨ä¸­ä¸åŒ…å«ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œå¹¶éµå¾ªæœ€ä½³å®è·µæ¥ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`docker commit` å‘½ä»¤æ˜¯å°†å®¹å™¨çš„çŠ¶æ€ä¿å­˜ä¸ºé•œåƒï¼Œè€Œä¸æ˜¯æ¨èçš„æ–¹æ³•

æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ Dockerfile æ¥å®šä¹‰å®¹å™¨çš„é…ç½®å’ŒçŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ `docker build` å‘½ä»¤æ„å»ºé•œåƒã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°è·Ÿè¸ªå’Œç®¡ç†é•œåƒçš„å˜æ›´

## dockfile

> æ„å»ºä¸€ä¸ªåŸºäºubuntuçš„anacondaç¯å¢ƒ

```cmd
# ä½¿ç”¨åŸºç¡€é•œåƒï¼Œé€‰æ‹©é€‚åˆæ‚¨çš„ç¯å¢ƒ
# FROM arm64v8/ubuntu:20.04
FROM ubuntu:20.04

# å®‰è£…ä¾èµ–åº“å’Œå·¥å…·
RUN apt update
RUN apt-get install -y wget

# ä¸‹è½½å¹¶å®‰è£… Anaconda  https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/
RUN wget -qO ~/anaconda.sh https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.03-0-Linux-x86_64.sh
# RUN wget -qO ~/anaconda.sh https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.03-0-Linux-aarch64.sh
RUN /bin/bash ~/anaconda.sh -b -p /opt/anaconda3
RUN rm ~/anaconda.sh

# å°† Anaconda æ·»åŠ åˆ°ç¯å¢ƒå˜é‡
ENV PATH="/opt/anaconda3/bin:${PATH}"
RUN conda create -y -n chat38 python=3.8 anaconda

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# æŒ‡å®šå…¨å±€ shell ç¯å¢ƒï¼Œè¿™æ ·æ‰èƒ½ç”¨source
SHELL ["/bin/bash", "-c"]

# åˆ‡æ¢pyç¯å¢ƒ
CMD source activate chat38
RUN pip install simplejson
```

é™¤äº†`SHELL ["/bin/bash", "-c"]`ï¼Œè¿˜å¯ä»¥**æ¯æ¬¡æŒ‡å®š**bashç¯å¢ƒï¼Œ`CMD /bin/bash -c "source activate chat38"`

## å‘å¸ƒå’Œéƒ¨ç½²

è¦å°†é•œåƒå‘å¸ƒåˆ° Docker Hub ä¸Šï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

**æ³¨å†Œ Docker Hub è´¦å·**ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰ Docker Hub è´¦å·ï¼Œé¦–å…ˆéœ€è¦åœ¨[Docker Hub](https://hub.docker.com/)çš„å®˜æ–¹ç½‘ç«™ä¸Šè¿›è¡Œæ³¨å†Œ

**ç™»å½• Docker Hub**ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç»ˆç«¯ä¸­ç™»å½•åˆ° Docker Hub

```cmd
Q:\pyCharmWS\chatgpts\dockfiles>docker login -u narutohyc
Password:
Login Succeeded
```

**æ ‡è®°é•œåƒ**ï¼Œåœ¨å‘å¸ƒåˆ° Docker Hub ä¹‹å‰ï¼Œéœ€è¦ä¸ºé•œåƒæ·»åŠ ä¸€ä¸ªé€‚å½“çš„æ ‡ç­¾ï¼Œä»¥ä¾¿å°†å…¶ä¸ä½ çš„ Docker Hub ç”¨æˆ·åå’Œå­˜å‚¨åº“å…³è”èµ·æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºé•œåƒæ·»åŠ æ ‡ç­¾

```cmd
docker tag <IMAGE_ID> <DOCKER_HUB_USERNAME>/<REPOSITORY_NAME>:<TAG>
```

å…¶ä¸­ï¼Œ`<IMAGE_ID>` æ˜¯ä½ è¦å‘å¸ƒçš„é•œåƒçš„ IDï¼Œ`<DOCKER_HUB_USERNAME>` æ˜¯ä½ çš„ Docker Hub ç”¨æˆ·åï¼Œ`<REPOSITORY_NAME>` æ˜¯ä½ æƒ³è¦ä¸ºé•œåƒè®¾ç½®çš„å­˜å‚¨åº“åç§°ï¼Œ`<TAG>` æ˜¯ä¸€ä¸ªå¯é€‰çš„æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†é•œåƒçš„ç‰ˆæœ¬å·

**å‘å¸ƒé•œåƒ**ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ ‡è®°åçš„é•œåƒå‘å¸ƒåˆ° Docker Hub

```cmd
docker push <DOCKER_HUB_USERNAME>/<REPOSITORY_NAME>:<TAG>
```

è¿™å°†æŠŠé•œåƒæ¨é€åˆ° Docker Hub ä¸Šçš„æŒ‡å®šå­˜å‚¨åº“ä¸­

**ç¡®è®¤å‘å¸ƒ**ï¼Œç™»å½•åˆ° Docker Hub çš„ç½‘ç«™ï¼Œè®¿é—®ä½ çš„ Docker Hub è´¦å·ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ç›¸åº”çš„å­˜å‚¨åº“ä¸­çœ‹åˆ°å·²å‘å¸ƒçš„é•œåƒ

è¯·æ³¨æ„ï¼Œå‘å¸ƒåˆ° Docker Hub çš„é•œåƒå°†æˆä¸ºå…¬å¼€å¯è®¿é—®çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä» Docker Hub ä¸Šè·å–å¹¶ä½¿ç”¨è¯¥é•œåƒã€‚å¦‚æœä½ å¸Œæœ›é™åˆ¶è®¿é—®æƒé™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç§æœ‰ä»“åº“ï¼Œæˆ–è€…åœ¨ Docker Hub ä¸Šåˆ›å»ºä¸€ä¸ªç§æœ‰çš„ç»„ç»‡æ¥ç®¡ç†é•œåƒçš„è®¿é—®æƒé™

## ç¤ºä¾‹

> æ¼”ç¤º Docker å®‰è£… Redis

ä¸€ä¸ªå‘½ä»¤è·‘èµ·æ¥ï¼š`docker run -d -p 6379:6379 --name redis redis:latest`

å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/run/

> å®‰è£… Wordpress

å®šä¹‰`docker-compose.yml`æ–‡ä»¶

```yaml
version: '3.1'

services:

  wordpress:
    image: wordpress
    restart: always
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: exampleuser
      WORDPRESS_DB_PASSWORD: examplepass
      WORDPRESS_DB_NAME: exampledb
    volumes:
      - wordpress:/var/www/html

  db:
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_DATABASE: exampledb
      MYSQL_USER: exampleuser
      MYSQL_PASSWORD: examplepass
      MYSQL_RANDOM_ROOT_PASSWORD: '1'
    volumes:
      - db:/var/lib/mysql

volumes:
  wordpress:
  db:
```

æ‰§è¡Œ`docker-compose up -d`



# å®æˆ˜neo4j

> [dockerå®‰è£…éƒ¨ç½²neo4j](https://www.cnblogs.com/caoyusang/p/13610408.html)

## å®‰è£…neo4j

> æ‹‰å–neo4jé•œåƒ

1. ä»[dockerå®˜æ–¹é•œåƒ](https://hub.docker.com/search?type=image)ä¸­æ‰¾åˆé€‚çš„é•œåƒ

   ```sh
   docker search neo4j
   ```

2. æ‹‰å–é•œåƒæº

   ```sh
   docker pull neo4j(:ç‰ˆæœ¬å·) # ç¼ºçœ ":ç‰ˆæœ¬å·" æ—¶é»˜è®¤å®‰è£…latestç‰ˆæœ¬çš„
   ```

3. æŸ¥çœ‹æœ¬åœ°é•œåƒï¼Œæ£€éªŒæ˜¯å¦æ‹‰å–æˆåŠŸ

   ```sh
   docker images
   ```

## å›¾ç®—æ³•æ’ä»¶

> neo4jæä¾›äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„[å›¾ç®—æ³•](https://neo4j.com/download-center/#ngds)ï¼Œè¯¥ç®—æ³•åº“éœ€è¦å•ç‹¬å®‰è£…ï¼Œæ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»

1. ç‚¹å‡»ä¸Šæ–¹å®˜ç½‘é“¾æ¥ï¼Œä¸‹è½½`Neo4j Graph Data Science`ä¸‹çš„æ–‡ä»¶ï¼Œæ”¾åˆ°`$NEO4J_HOME/plugins`ç›®å½•ä¸­

2. å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„`$NEO4J_HOME/conf/neo4j.conf`æ–‡ä»¶ä¸­ï¼Œ[å‚è€ƒè¿™é‡Œ](https://www.likecs.com/show-204290898.html)

   ```yaml
   dbms.security.procedures.unrestricted=apoc.*,gds.*
   ```

   æ­¤é…ç½®æ¡ç›®æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º GDS åº“è®¿é—® Neo4j çš„ä½çº§ç»„ä»¶ä»¥æœ€å¤§åŒ–æ€§èƒ½

3. é‡å¯ Neo4jï¼Œåœ¨dockerä¸‹å°±æ˜¯é‡å¯

> ä¸ºäº†éªŒè¯æ‚¨çš„å®‰è£…ï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤

```cmd
RETURN gds.version()
```

è¦åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„ç®—æ³•ï¼Œè¯·è¿è¡Œä»¥ä¸‹`gds.list()`è¿‡ç¨‹

```cmd
CALL gds.list()
```

ä¾‹å­: [neo4jå®ç°PageRankç®—æ³•](https://blog.csdn.net/weixin_51432117/article/details/109965487)

## å¯åŠ¨neo4j

æ‰¾ä¸€ä¸ªç›®å½•å­˜æ”¾dockerçš„å„é•œåƒè¿è¡Œç›®å½•ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œé€‰çš„æ˜¯/home/huangyc/docker

ç„¶åå†åœ¨è¿™ä¸ªç›®å½•æ–°å»ºå…·ä½“çš„é•œåƒå¯¹åº”çš„æ–‡ä»¶å¤¹/home/huangyc/docker/neo4jï¼Œåœ¨ä¸‹é¢æ–°å»ºå››ä¸ªæ–‡ä»¶å¤¹(å®é™…ä¸Šå¥½åƒä¸éœ€è¦æ‰‹åŠ¨å»ºï¼Œæ‰§è¡Œå‘½ä»¤æ—¶è‡ªåŠ¨ä¼šæ–°å»º)

- **data**: æ•°æ®å­˜æ”¾çš„æ–‡ä»¶å¤¹
- **logs**: è¿è¡Œçš„æ—¥å¿—æ–‡ä»¶å¤¹
- **conf**: æ•°æ®åº“é…ç½®æ–‡ä»¶å¤¹(åœ¨é…ç½®æ–‡ä»¶**neo4j.conf**ä¸­é…ç½®åŒ…æ‹¬å¼€æ”¾è¿œç¨‹è¿æ¥ã€è®¾ç½®é»˜è®¤æ¿€æ´»çš„æ•°æ®åº“)
- **import**: ä¸ºäº†å¤§æ‰¹é‡å¯¼å…¥csvæ¥æ„å»ºæ•°æ®åº“ï¼Œéœ€è¦å¯¼å…¥çš„èŠ‚ç‚¹æ–‡ä»¶**nodes.csv**å’Œå…³ç³»æ–‡ä»¶**rel.csv**éœ€è¦æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹
- **plugins**: å­˜æ”¾jaræ’ä»¶

> å¯åŠ¨å‘½ä»¤æ ¼å¼å¦‚ä¸‹

```sh
docker run -d --name container_name \  //-dè¡¨ç¤ºå®¹å™¨åå°è¿è¡Œ --nameæŒ‡å®šå®¹å™¨åå­—
	-p 7474:7474 -p 7687:7687 \  //æ˜ å°„å®¹å™¨çš„ç«¯å£å·åˆ°å®¿ä¸»æœºçš„ç«¯å£å·
	-v /home/huangyc/docker/neo4j/data:/data \  //æŠŠå®¹å™¨å†…çš„æ•°æ®ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºçš„å¯¹åº”ç›®å½•ä¸‹
	-v /home/huangyc/docker/neo4j/logs:/logs \  //æŒ‚è½½æ—¥å¿—ç›®å½•
	-v /home/huangyc/docker/neo4j/conf:/var/lib/neo4j/conf   //æŒ‚è½½é…ç½®ç›®å½•
	-v /home/huangyc/docker/neo4j/import:/var/lib/neo4j/import \  //æŒ‚è½½æ•°æ®å¯¼å…¥ç›®å½•
	-v /home/huangyc/docker/neo4j/plugins:/var/lib/neo4j/plugins \  //æŒ‚è½½æ•°æ®å¯¼å…¥ç›®å½•
	--env NEO4J_AUTH=neo4j/password \  //è®¾å®šæ•°æ®åº“çš„ç”¨æˆ·åå’Œå’Œå¯†ç 
	neo4j //æŒ‡å®šä½¿ç”¨çš„é•œåƒ
```

ä¹Ÿå¯ä»¥å†™æˆå•è¡Œå‘½ä»¤

```sh
docker run -d --name neo4j_hyc -p 7474:7474 -p 7687:7687 -v /home/huangyc/docker/neo4j/data:/data -v /home/huangyc/docker/neo4j/logs:/logs -v /home/huangyc/docker/neo4j/conf:/var/lib/neo4j/conf -v /home/huangyc/docker/neo4j/import:/var/lib/neo4j/import -v /home/huangyc/docker/neo4j/plugins:/var/lib/neo4j/plugins --env NEO4J_AUTH=neo4j/hyc neo4j
```



## pyåº“

ä½¿ç”¨Pythonè®¿é—®å›¾æ•°æ®åº“ï¼Œä¸»è¦ä½¿ç”¨çš„åº“æ—¶`py2neo`å’Œ`neo4j`ï¼Œ

* py2neoé€šè¿‡æ“ä½œpythonå˜é‡ï¼Œè¾¾åˆ°æ“ä½œneo4jçš„ç›®çš„ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ`cypher`è¯­æ³•
* neo4jä¸»è¦æ—¶æ‰§è¡ŒCQL(cypher)è¯­å¥

{% note success modern %}[cypher è¯­æ³•](https://neo4j.com/docs/cypher-refcard/current/){% endnote %}

{% tabs å……åˆ†æ¡ä»¶ %}
<!-- tab py2neo -->

å®‰è£…

```sh
pip install py2neo
```

ä½¿ç”¨ä¾‹å­

```python
# coding:utf-8
from py2neo import Graph, Node, Relationship
 
# è¿æ¥neo4jæ•°æ®åº“ï¼Œè¾“å…¥åœ°å€ã€ç”¨æˆ·åã€å¯†ç 
graph = Graph("http://192.168.1.106:7474", name="neo4j")
graph.delete_all()
# åˆ›å»ºç»“ç‚¹
test_node_1 = Node('ru_yi_zhuan', name='çš‡å¸') # ä¿®æ”¹çš„éƒ¨åˆ†
test_node_2 = Node('ru_yi_zhuan', name='çš‡å') # ä¿®æ”¹çš„éƒ¨åˆ†
test_node_3 = Node('ru_yi_zhuan', name='å…¬ä¸»') # ä¿®æ”¹çš„éƒ¨åˆ†
 
graph.create(test_node_1)
graph.create(test_node_2)
graph.create(test_node_3)
 
# åˆ›å»ºå…³ç³»
# åˆ†åˆ«å»ºç«‹äº†test_node_1æŒ‡å‘test_node_2å’Œtest_node_2æŒ‡å‘test_node_1ä¸¤æ¡å…³ç³»ï¼Œå…³ç³»çš„ç±»å‹ä¸º"ä¸ˆå¤«ã€å¦»å­"ï¼Œä¸¤æ¡å…³ç³»éƒ½æœ‰å±æ€§countï¼Œä¸”å€¼ä¸º1ã€‚
node_1_zhangfu_node_1 = Relationship(test_node_1, 'ä¸ˆå¤«', test_node_2)
node_1_zhangfu_node_1['count'] = 1
node_2_qizi_node_1 = Relationship(test_node_2, 'å¦»å­', test_node_1)
node_2_munv_node_1 = Relationship(test_node_2, 'æ¯å¥³', test_node_3)
 
node_2_qizi_node_1['count'] = 1
 
graph.create(node_1_zhangfu_node_1)
graph.create(node_2_qizi_node_1)
graph.create(node_2_munv_node_1)
 
print(graph)
print(test_node_1)
print(test_node_2)
print(node_1_zhangfu_node_1)
print(node_2_qizi_node_1)
print(node_2_munv_node_1) 
```

<!-- endtab -->

<!-- tab neo4j -->

å®‰è£…

```sh
pip install neo4j
```

ä½¿ç”¨ä¾‹å­

```python
from neo4j import GraphDatabase

driver = GraphDatabase.driver("bolt://localhost:7687", auth=("neo4j", "password"))

def add_friend(tx, name, friend_name):
    tx.run("MERGE (a:Person {name: $name}) "
           "MERGE (a)-[:KNOWS]->(friend:Person {name: $friend_name})",
           name=name, friend_name=friend_name)

def print_friends(tx, name):
    for record in tx.run("MATCH (a:Person)-[:KNOWS]->(friend) WHERE a.name = $name "
                         "RETURN friend.name ORDER BY friend.name", name=name):
        print(record["friend.name"])

with driver.session() as session:
    session.write_transaction(add_friend, "Arthur", "Guinevere")
    session.write_transaction(add_friend, "Arthur", "Lancelot")
    session.write_transaction(add_friend, "Arthur", "Merlin")
    session.read_transaction(print_friends, "Arthur")
```

<!-- endtab -->

{% endtabs %}



# å®æˆ˜nebula

## åŸºæœ¬ä»‹ç»

NebulaGraph ç”±ä¸‰ç§æœåŠ¡æ„æˆï¼šGraph æœåŠ¡ã€Meta æœåŠ¡å’Œ Storage æœåŠ¡ï¼Œæ˜¯ä¸€ç§å­˜å‚¨ä¸è®¡ç®—åˆ†ç¦»çš„æ¶æ„

> Meta æœåŠ¡

Meta æœåŠ¡æ˜¯ç”± `nebula-metad è¿›ç¨‹`æä¾›çš„ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®åœºæ™¯é…ç½® nebula-metad è¿›ç¨‹æ•°é‡ï¼š

- æµ‹è¯•ç¯å¢ƒä¸­ï¼Œç”¨æˆ·å¯ä»¥åœ¨ NebulaGraph é›†ç¾¤ä¸­éƒ¨ç½² 1 ä¸ªæˆ– 3 ä¸ª nebula-metad è¿›ç¨‹ã€‚å¦‚æœè¦éƒ¨ç½² 3 ä¸ªï¼Œç”¨æˆ·å¯ä»¥å°†å®ƒä»¬éƒ¨ç½²åœ¨ 1 å°æœºå™¨ä¸Šï¼Œæˆ–è€…åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚
- ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®åœ¨ NebulaGraph é›†ç¾¤ä¸­éƒ¨ç½² 3 ä¸ª nebula-metad è¿›ç¨‹ã€‚è¯·å°†è¿™äº›è¿›ç¨‹éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šä»¥ä¿è¯é«˜å¯ç”¨ã€‚

æ‰€æœ‰ nebula-metad è¿›ç¨‹æ„æˆäº†åŸºäº Raft åè®®çš„é›†ç¾¤ï¼Œå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æ˜¯ leaderï¼Œå…¶ä»–è¿›ç¨‹éƒ½æ˜¯ followerã€‚

leader æ˜¯ç”±å¤šæ•°æ´¾é€‰ä¸¾å‡ºæ¥ï¼Œåªæœ‰ leader èƒ½å¤Ÿå¯¹å®¢æˆ·ç«¯æˆ–å…¶ä»–ç»„ä»¶æä¾›æœåŠ¡ï¼Œå…¶ä»– follower ä½œä¸ºå€™è¡¥ï¼Œå¦‚æœ leader å‡ºç°æ•…éšœï¼Œä¼šåœ¨æ‰€æœ‰ follower ä¸­é€‰ä¸¾å‡ºæ–°çš„ leaderã€‚

> Graph æœåŠ¡

Graph æœåŠ¡æ˜¯ç”±`nebula-graphd è¿›ç¨‹`æä¾›ï¼ŒæœåŠ¡ä¸»è¦è´Ÿè´£å¤„ç†æŸ¥è¯¢è¯·æ±‚ï¼ŒåŒ…æ‹¬è§£ææŸ¥è¯¢è¯­å¥ã€æ ¡éªŒè¯­å¥ã€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ä»¥åŠæŒ‰ç…§æ‰§è¡Œè®¡åˆ’æ‰§è¡Œå››ä¸ªå¤§æ­¥éª¤ï¼ŒæŸ¥è¯¢è¯·æ±‚å‘é€åˆ° Graph æœåŠ¡åï¼Œä¼šç”±å¦‚ä¸‹æ¨¡å—ä¾æ¬¡å¤„ç†ï¼š

1. **Parser**ï¼šè¯æ³•è¯­æ³•è§£ææ¨¡å—ã€‚
2. **Validator**ï¼šè¯­ä¹‰æ ¡éªŒæ¨¡å—ã€‚
3. **Planner**ï¼šæ‰§è¡Œè®¡åˆ’ä¸ä¼˜åŒ–å™¨æ¨¡å—ã€‚
4. **Executor**ï¼šæ‰§è¡Œå¼•æ“æ¨¡å—ã€‚

> Storage æœåŠ¡

NebulaGraph çš„å­˜å‚¨åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ Meta ç›¸å…³çš„å­˜å‚¨ï¼Œç§°ä¸º Meta æœåŠ¡ï¼Œåœ¨å‰æ–‡å·²æœ‰ä»‹ç»ã€‚

å¦ä¸€ä¸ªæ˜¯å…·ä½“æ•°æ®ç›¸å…³çš„å­˜å‚¨ï¼Œç§°ä¸º Storage æœåŠ¡ã€‚å…¶è¿è¡Œåœ¨ `nebula-storaged è¿›ç¨‹`ä¸­

## ç¯å¢ƒæ­å»º

> ä»¥[nebula 3.2.1](https://docs.nebula-graph.com.cn/3.2.1/4.deployment-and-installation/2.compile-and-install-nebula-graph/deploy-nebula-graph-cluster/)ä¸ºä¾‹

ä¸‹è½½å¹¶å®‰è£…NebulaGraph

```sh
wget https://oss-cdn.nebula-graph.com.cn/package/3.2.1/nebula-graph-3.2.1.el7.x86_64.rpm
sudo rpm -ivh --prefix=/home/huangyc/nebula nebula-graph-3.2.1.el7.x86_64.rpm
```

`--prefix`ä¸ºå¯é€‰é¡¹ï¼Œç”¨äºæŒ‡å®šå®‰è£…è·¯å¾„

å¦‚ä¸è®¾ç½®ï¼Œç³»ç»Ÿä¼šå°† NebulaGraph å®‰è£…åˆ°é»˜è®¤è·¯å¾„`/usr/local/nebula/`

> é›†ç¾¤é…ç½®

{% note success modern %}é›†ç¾¤é…ç½®éœ€è¦ä¿è¯é›†ç¾¤æœºå™¨[é…ç½®sshå…å¯†](https://hycbook.com/article/d192a1af.html){% endnote %}

ä¿®æ”¹æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„ NebulaGraph é…ç½®æ–‡ä»¶

NebulaGraph çš„æ‰€æœ‰é…ç½®æ–‡ä»¶å‡ä½äºå®‰è£…ç›®å½•çš„`etc`ç›®å½•å†…ï¼ŒåŒ…æ‹¬`nebula-graphd.conf`ã€`nebula-metad.conf`å’Œ`nebula-storaged.conf`ï¼Œç”¨æˆ·å¯ä»¥åªä¿®æ”¹æ‰€éœ€æœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚å„ä¸ªæœºå™¨éœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ã€‚

| æœºå™¨åç§° | å¾…ä¿®æ”¹é…ç½®æ–‡ä»¶                                               |
| -------- | ------------------------------------------------------------ |
| A        | `nebula-graphd.conf`ã€`nebula-storaged.conf`ã€`nebula-metad.conf` |
| B        | `nebula-graphd.conf`ã€`nebula-storaged.conf`ã€`nebula-metad.conf` |
| C        | `nebula-graphd.conf`ã€`nebula-storaged.conf`ã€`nebula-metad.conf` |
| D        | `nebula-graphd.conf`ã€`nebula-storaged.conf`                 |
| E        | `nebula-graphd.conf`ã€`nebula-storaged.conf`                 |

* æœºå™¨ A é…ç½®

  nebula-graphd.conf

  ```sh
  ########## networking ##########
  # Comma separated Meta Server Addresses
  --meta_server_addrs=192.168.10.111:9559,192.168.10.112:9559,192.168.10.113:9559
  # Local IP used to identify the nebula-graphd process.
  # Change it to an address other than loopback if the service is distributed or
  # will be accessed remotely.
  --local_ip=192.168.10.111
  # Network device to listen on
  --listen_netdev=any
  # Port to listen on
  --port=9669
  ```

  nebula-storaged.conf

  ```sh
  ########## networking ##########
  # Comma separated Meta server addresses
  --meta_server_addrs=192.168.10.111:9559,192.168.10.112:9559,192.168.10.113:9559
  # Local IP used to identify the nebula-storaged process.
  # Change it to an address other than loopback if the service is distributed or
  # will be accessed remotely.
  --local_ip=192.168.10.111
  # Storage daemon listening port
  --port=9779
  ```

  nebula-metad.conf

  ```sh
  ########## networking ##########
  # Comma separated Meta Server addresses
  --meta_server_addrs=192.168.10.111:9559,192.168.10.112:9559,192.168.10.113:9559
  # Local IP used to identify the nebula-metad process.
  # Change it to an address other than loopback if the service is distributed or
  # will be accessed remotely.
  --local_ip=192.168.10.111
  # Meta daemon listening port
  --port=9559
  ```

* æœºå™¨ D é…ç½®

  nebula-graphd.conf

  ```sh
  ########## networking ##########
  # Comma separated Meta Server Addresses
  --meta_server_addrs=192.168.10.111:9559,192.168.10.112:9559,192.168.10.113:9559
  # Local IP used to identify the nebula-graphd process.
  # Change it to an address other than loopback if the service is distributed or
  # will be accessed remotely.
  --local_ip=192.168.10.114
  # Network device to listen on
  --listen_netdev=any
  # Port to listen on
  --port=9669
  ```

  nebula-storaged.conf

  ```sh
  ########## networking ##########
  # Comma separated Meta server addresses
  --meta_server_addrs=192.168.10.111:9559,192.168.10.112:9559,192.168.10.113:9559
  # Local IP used to identify the nebula-storaged process.
  # Change it to an address other than loopback if the service is distributed or
  # will be accessed remotely.
  --local_ip=192.168.10.114
  # Storage daemon listening port
  --port=9779
  ```

* ABCä¸‰å°é…ç½®é™¤äº†`local_ip`ï¼Œå…¶ä»–éƒ½ä¸€è‡´ï¼ŒDEä¸¤å°é…ç½®é™¤äº†`local_ip`ï¼Œå…¶ä»–éƒ½ä¸€è‡´

å¯åŠ¨æœåŠ¡

## å‘½ä»¤å­¦ä¹ 

ä½¿ç”¨è„šæœ¬`nebula.service`ç®¡ç†æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€ä¸­æ­¢å’ŒæŸ¥çœ‹

`nebula.service`çš„é»˜è®¤è·¯å¾„æ˜¯`/usr/local/nebula/scripts`ï¼Œå¦‚æœä¿®æ”¹è¿‡å®‰è£…è·¯å¾„ï¼Œè¯·ä½¿ç”¨å®é™…è·¯å¾„

> è¯­æ³•

```sh
sudo /usr/local/nebula/scripts/nebula.service
[-v] [-c <config_file_path>]
<start | stop | restart | kill | status>
<metad | graphd | storaged | all>
```

æ¯”å¦‚å¯¹äºéå®¹å™¨éƒ¨ç½²çš„ NebulaGraphï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š

```sh
sudo /usr/local/nebula/scripts/nebula.service start all
[INFO] Starting nebula-metad...
[INFO] Done
[INFO] Starting nebula-graphd...
[INFO] Done
[INFO] Starting nebula-storaged...
[INFO] Done
```

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ NebulaGraph æœåŠ¡çŠ¶æ€

```sh
sudo /usr/local/nebula/scripts/nebula.service status all
```

å¦‚æœè¿”å›å¦‚ä¸‹ç»“æœï¼Œè¡¨ç¤º NebulaGraph æœåŠ¡æ­£å¸¸è¿è¡Œ

```
[INFO] nebula-metad(33fd35e): Running as 29020, Listening on 9559
[INFO] nebula-graphd(33fd35e): Running as 29095, Listening on 9669
[WARN] nebula-storaged after v3.0.0 will not start service until it is added to cluster.
[WARN] See Manage Storage hosts:ADD HOSTS in https://docs.nebula-graph.io/
[INFO] nebula-storaged(33fd35e): Running as 29147, Listening on 9779
```

æ­£å¸¸å¯åŠ¨ NebulaGraph åï¼Œ`nebula-storaged`è¿›ç¨‹çš„ç«¯å£æ˜¾ç¤ºçº¢è‰²ã€‚è¿™æ˜¯å› ä¸º`nebula-storaged`åœ¨å¯åŠ¨æµç¨‹ä¸­ä¼šç­‰å¾…`nebula-metad`æ·»åŠ å½“å‰ Storage æœåŠ¡ï¼Œå½“å‰ Storage æœåŠ¡æ”¶åˆ° Ready ä¿¡å·åæ‰ä¼šæ­£å¼å¯åŠ¨æœåŠ¡ã€‚ä» 3.0.0 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ çš„ Storage èŠ‚ç‚¹æ— æ³•ç›´æ¥è¯»å†™ï¼Œé…ç½®æ–‡ä»¶çš„ä½œç”¨ä»…ä»…æ˜¯å°† Storage èŠ‚ç‚¹æ³¨å†Œè‡³ Meta æœåŠ¡ä¸­ã€‚å¿…é¡»ä½¿ç”¨`ADD HOSTS`å‘½ä»¤åï¼Œæ‰èƒ½æ­£å¸¸è¯»å†™ Storage èŠ‚ç‚¹ã€‚

> æ³¨å†Œ

å…·ä½“æ˜¯é€šè¿‡nebula-consoleå‘½ä»¤è¡Œæˆ–è€…studioé¡µé¢æ‰§è¡Œï¼Œç”¨ java client ä¹Ÿå¯ä»¥çš„, åº•å±‚é€»è¾‘éƒ½æ˜¯é€šè¿‡å®¢æˆ·ç«¯å‘é€ä¸€æ¡ `add hosts xxxxx` query

```sh
ADD HOSTS 192.168.40.39:9779, 192.168.40.40:9779, 192.168.40.41:9779;
```

æ¯”å¦‚ä½¿ç”¨pythonå®¢æˆ·ç«¯

```python
from nebula3.gclient.net import ConnectionPool
from nebula3.Config import Config

# define a config
config = Config()
config.max_connection_pool_size = 10
# init connection pool
connection_pool = ConnectionPool()
# if the given servers are ok, return true, else return false
ok = connection_pool.init([('192.168.123.xx', 9669)], config)

# option 1 control the connection release yourself
# get session from the pool
session = connection_pool.get_session('root', 'nebula')

session.execute("ADD HOSTS 192.168.123.24:9779")
```

ç­‰å¾…20såï¼Œé‡æ–°æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œå‘ç°è­¦å‘Šæ²¡æœ‰å°±è¯´æ˜æˆåŠŸäº†

```sh
[root@localhost nebula]# sudo scripts/nebula.service status all
[WARN] The maximum files allowed to open might be too few: 1024
[INFO] nebula-metad(bb2e684): Running as 11660, Listening on 9559
[INFO] nebula-graphd(bb2e684): Running as 11727, Listening on 9669
[INFO] nebula-storaged(bb2e684): Running as 11764, Listening on 9779
```

> æ¸…ç©ºå›¾

- æ•°æ®æ¸…é™¤åï¼Œ**å¦‚æ— å¤‡ä»½ï¼Œæ— æ³•æ¢å¤**ã€‚ä½¿ç”¨è¯¥åŠŸèƒ½åŠ¡å¿…è°¨æ…

  `CLEAR SPACE`ä¸æ˜¯åŸå­æ€§æ“ä½œã€‚å¦‚æœæ‰§è¡Œå‡ºé”™ï¼Œè¯·é‡æ–°æ‰§è¡Œï¼Œé¿å…æ®‹ç•™æ•°æ®

- å›¾ç©ºé—´ä¸­çš„æ•°æ®é‡è¶Šå¤§ï¼Œ`CLEAR SPACE`æ¶ˆè€—çš„æ—¶é—´è¶Šé•¿

  å¦‚æœ`CLEAR SPACE`çš„æ‰§è¡Œå› å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶è€Œå¤±è´¥ï¼Œå¯ä»¥å¢å¤§ [Graph æœåŠ¡é…ç½®](https://docs.nebula-graph.com.cn/3.2.1/5.configurations-and-logs/1.configurations/3.graph-config/)ä¸­`storage_client_timeout_ms`å‚æ•°çš„å€¼

- åœ¨`CLEAR SPACE`çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘è¯¥å›¾ç©ºé—´å†™å…¥æ•°æ®çš„è¡Œä¸ºä¸ä¼šè¢«è‡ªåŠ¨ç¦æ­¢

  è¿™æ ·çš„å†™å…¥è¡Œä¸ºå¯èƒ½å¯¼è‡´`CLEAR SPACE`æ¸…é™¤æ•°æ®ä¸å®Œå…¨ï¼Œæ®‹ç•™çš„æ•°æ®ä¹Ÿå¯èƒ½å—åˆ°æŸå

```sh
CLEAR SPACE [IF EXISTS] <space_name>;
```

ä¿ç•™çš„æ•°æ®[Â¶](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/9.space-statements/6.clear-space/#_4)

å›¾ç©ºé—´ä¸­ï¼Œ`CLEAR SPACE`ä¸ä¼šåˆ é™¤çš„æ•°æ®åŒ…æ‹¬ï¼š

- Tag ä¿¡æ¯
- Edge type ä¿¡æ¯
- åŸç”Ÿç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•çš„å…ƒæ•°æ®

`DROP SPACE`è¯­å¥ç”¨äºåˆ é™¤æŒ‡å®šå›¾ç©ºé—´ä»¥åŠå…¶ä¸­çš„æ‰€æœ‰ä¿¡æ¯

```sh
DROP SPACE [IF EXISTS] <graph_space_name>;
```

## å®¢æˆ·ç«¯

NebulaGraph æ”¯æŒå¤šç§ç±»å‹çš„å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œå®¢æˆ·ç«¯ã€å¯è§†åŒ–ç•Œé¢å®¢æˆ·ç«¯å’Œæµè¡Œç¼–ç¨‹è¯­è¨€å®¢æˆ·ç«¯

è¯¦æƒ…å‚è§[å®¢æˆ·ç«¯åˆ—è¡¨](https://docs.nebula-graph.com.cn/3.2.1/14.client/1.nebula-client/)

{% tabs å®¢æˆ·ç«¯ %}
<!-- tab åŸç”ŸCLIå®¢æˆ·ç«¯ -->

> å‰ææ¡ä»¶[Â¶](https://docs.nebula-graph.com.cn/3.2.1/4.deployment-and-installation/connect-to-nebula-graph/#_1)
>
> [å®˜æ–¹æ–‡æ¡£](https://docs.nebula-graph.com.cn/3.2.1/nebula-console/)

- NebulaGraph æœåŠ¡å·²[å¯åŠ¨](https://docs.nebula-graph.com.cn/3.2.1/4.deployment-and-installation/manage-service/)

- è¿è¡Œ NebulaGraph Console çš„æœºå™¨å’Œè¿è¡Œ NebulaGraph çš„æœåŠ¡å™¨ç½‘ç»œäº’é€š

- NebulaGraph Console çš„ç‰ˆæœ¬å…¼å®¹ NebulaGraph çš„ç‰ˆæœ¬

ä½¿ç”¨å‘½ä»¤`arch`ï¼ŒæŸ¥çœ‹ç³»ç»Ÿç»“æ„ï¼Œå»[å®˜ç½‘](https://github.com/vesoft-inc/nebula-console/releases)ä¸‹è½½å®‰è£…åŒ…ï¼Œé‡å‘½åæ–‡ä»¶ä¸º`nebula_console`

1. ä¸ºç”¨æˆ·æˆäºˆ nebula-console æ–‡ä»¶çš„æ‰§è¡Œæƒé™

   ```sh
   chmod 111 nebula-console
   ```

2. åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­ï¼Œåˆ‡æ¢å·¥ä½œç›®å½•è‡³ nebula-console æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿æ¥ NebulaGraph

   ```sh
   ./nebula-console -addr <ip> -port <port> -u <username> -p <password> [-t 120] [-e "nGQL_statement" | -f filename.nGQL]
   ```

   ä¾‹å¦‚ï¼Œè¦è¿æ¥åˆ°éƒ¨ç½²åœ¨ 192.168.10.8 ä¸Šçš„ Graph æœåŠ¡ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤

   ```sh
   ./nebula_console -addr 192.168.10.8 -port 9669 -u root -p nebula
   ```

<!-- endtab -->

<!-- tab pythonå®¢æˆ·ç«¯ -->

å·²å®‰è£… Pythonï¼Œç‰ˆæœ¬ä¸º 3.6 åŠä»¥ä¸Šï¼Œç‰ˆæœ¬å¯¹ç…§è¡¨[Â¶](https://docs.nebula-graph.com.cn/3.2.1/14.client/5.nebula-python-client/#_2)

| NebulaGraph ç‰ˆæœ¬ | NebulaGraph Python ç‰ˆæœ¬ |
| ---------------- | ----------------------- |
| 3.2.1            | 3.1.0                   |
| 2.6.x            | 2.6.0                   |

> pipå®‰è£…

```sh
$ pip install nebula3-python==<version>
```

<!-- endtab -->

{% endtabs %}



> åˆå§‹åŒ–ä¸€äº›[æ•°æ®](https://docs.nebula-graph.com.cn/3.2.1/2.quick-start/4.nebula-graph-crud/#_2)

1. æ‰§è¡Œå¦‚ä¸‹è¯­å¥åˆ›å»ºåä¸º`basketballplayer`çš„å›¾ç©ºé—´

   ```sh
   CREATE SPACE basketballplayer(partition_num=15, replica_factor=1, vid_type=fixed_string(32));
   ```

2. æ‰§è¡Œå‘½ä»¤`SHOW HOSTS`æ£€æŸ¥åˆ†ç‰‡çš„åˆ†å¸ƒæƒ…å†µï¼Œç¡®ä¿å¹³è¡¡åˆ†å¸ƒ

   ```sh
   nebula> SHOW HOSTS;
   +-------------+-----------+-----------+-----------+--------------+----------------------------------+------------------------+---------+
   | Host        | Port      | HTTP port | Status    | Leader count | Leader distribution              | Partition distribution | Version |
   +-------------+-----------+-----------+-----------+--------------+----------------------------------+------------------------+---------+
   | "storaged0" | 9779      | 19669     | "ONLINE"  | 5            | "basketballplayer:5"             | "basketballplayer:5"   | "3.1.0" |
   | "storaged1" | 9779      | 19669     | "ONLINE"  | 5            | "basketballplayer:5"             | "basketballplayer:5"   | "3.1.0" |
   | "storaged2" | 9779      | 19669     | "ONLINE"  | 5            | "basketballplayer:5"             | "basketballplayer:5"   | "3.1.0" |
   +-------------+-----------+-----------+-----------+--------------+----------------------------------+------------------------+---------+
   ```

3. é€‰æ‹©å›¾ç©ºé—´`basketballplayer`

   ```sh
   nebula[(none)]> USE basketballplayer;
   ```

   ç”¨æˆ·å¯ä»¥æ‰§è¡Œå‘½ä»¤`SHOW SPACES`æŸ¥çœ‹åˆ›å»ºçš„å›¾ç©ºé—´

   ```sh
   nebula> SHOW SPACES;
   +--------------------+
   | Name               |
   +--------------------+
   | "basketballplayer" |
   +--------------------+
   ```

4. åˆ›å»º Tag å’Œ Edge type

   è¯­æ³•:

   ```sh
   CREATE {TAG | EDGE} [IF NOT EXISTS] {<tag_name> | <edge_type_name>}
       (
         <prop_name> <data_type> [NULL | NOT NULL] [DEFAULT <default_value>] [COMMENT '<comment>']
         [{, <prop_name> <data_type> [NULL | NOT NULL] [DEFAULT <default_value>] [COMMENT '<comment>']} ...] 
       )
       [TTL_DURATION = <ttl_duration>]
       [TTL_COL = <prop_name>]
       [COMMENT = '<comment>'];
   ```

   åˆ›å»º Tag:`player`å’Œ`team`ï¼Œä»¥åŠ Edge type:`follow`å’Œ`serve`ã€‚è¯´æ˜å¦‚ä¸‹è¡¨ã€‚

   | åç§°   | ç±»å‹      | å±æ€§                             |
   | ------ | --------- | -------------------------------- |
   | player | Tag       | name (string), age (int)         |
   | team   | Tag       | name (string)                    |
   | follow | Edge type | degree (int)                     |
   | serve  | Edge type | start_year (int), end_year (int) |

   ```sh
   CREATE TAG player(name string, age int);
   CREATE TAG team(name string);
   CREATE EDGE follow(degree int);
   CREATE EDGE serve(start_year int, end_year int);
   ```

5. æ’å…¥ç‚¹å’Œè¾¹

   - æ’å…¥ç‚¹

     ```sh
     INSERT VERTEX [IF NOT EXISTS] [tag_props, [tag_props] ...]
     VALUES <vid>: ([prop_value_list])
     
     tag_props:
       tag_name ([prop_name_list])
     
     prop_name_list: [prop_name [, prop_name] ...]
     prop_value_list: [prop_value [, prop_value] ...]  
     ```

     `vid`æ˜¯ Vertex ID çš„ç¼©å†™ï¼Œ`vid`åœ¨ä¸€ä¸ªå›¾ç©ºé—´ä¸­æ˜¯å”¯ä¸€çš„ã€‚å‚æ•°è¯¦æƒ…è¯·å‚è§ [INSERT VERTEX](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/12.vertex-statements/1.insert-vertex/)

   - æ’å…¥è¾¹

     ```sh
     INSERT EDGE [IF NOT EXISTS] <edge_type> ( <prop_name_list> ) VALUES 
     <src_vid> -> <dst_vid>[@<rank>] : ( <prop_value_list> )
     [, <src_vid> -> <dst_vid>[@<rank>] : ( <prop_value_list> ), ...];
     
     <prop_name_list> ::= [ <prop_name> [, <prop_name> ] ...]
     <prop_value_list> ::= [ <prop_value> [, <prop_value> ] ...]
     ```

   å‚æ•°è¯¦æƒ…è¯·å‚è§ [INSERT EDGE](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/13.edge-statements/1.insert-edge/)

   - æ’å…¥ä»£è¡¨çƒå‘˜å’Œçƒé˜Ÿçš„ç‚¹

     ```sh
     nebula> INSERT VERTEX player(name, age) VALUES "player100":("Tim Duncan", 42);
     nebula> INSERT VERTEX player(name, age) VALUES "player101":("Tony Parker", 36);
     nebula> INSERT VERTEX player(name, age) VALUES "player102":("LaMarcus Aldridge", 33);
     nebula> INSERT VERTEX team(name) VALUES "team203":("Trail Blazers"), "team204":("Spurs");
     ```

   - æ’å…¥ä»£è¡¨çƒå‘˜å’Œçƒé˜Ÿä¹‹é—´å…³ç³»çš„è¾¹

     ```sh
     nebula> INSERT EDGE follow(degree) VALUES "player101" -> "player100":(95);
     nebula> INSERT EDGE follow(degree) VALUES "player101" -> "player102":(90);
     nebula> INSERT EDGE follow(degree) VALUES "player102" -> "player100":(75);
     nebula> INSERT EDGE serve(start_year, end_year) VALUES "player101" -> "team204":(1999, 2018),"player102" -> "team203":(2006,  2015);
     ```

6. æŸ¥è¯¢æ•°æ®[Â¶](https://docs.nebula-graph.com.cn/3.2.1/2.quick-start/4.nebula-graph-crud/#_7)

   - [GO](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/7.general-query-statements/3.go/) è¯­å¥å¯ä»¥æ ¹æ®æŒ‡å®šçš„æ¡ä»¶éå†æ•°æ®åº“ã€‚`GO`è¯­å¥ä»ä¸€ä¸ªæˆ–å¤šä¸ªç‚¹å¼€å§‹ï¼Œæ²¿ç€ä¸€æ¡æˆ–å¤šæ¡è¾¹éå†ï¼Œè¿”å›`YIELD`å­å¥ä¸­æŒ‡å®šçš„ä¿¡æ¯ã€‚

   - [FETCH](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/7.general-query-statements/4.fetch/) è¯­å¥å¯ä»¥è·å¾—ç‚¹æˆ–è¾¹çš„å±æ€§ã€‚

   - [LOOKUP](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/7.general-query-statements/5.lookup/) è¯­å¥æ˜¯åŸºäº[ç´¢å¼•](https://docs.nebula-graph.com.cn/3.2.1/2.quick-start/4.nebula-graph-crud/#_12)çš„ï¼Œå’Œ`WHERE`å­å¥ä¸€èµ·ä½¿ç”¨ï¼ŒæŸ¥æ‰¾ç¬¦åˆç‰¹å®šæ¡ä»¶çš„æ•°æ®ã€‚

   - [MATCH](https://docs.nebula-graph.com.cn/3.2.1/3.ngql-guide/7.general-query-statements/2.match/) è¯­å¥æ˜¯æŸ¥è¯¢å›¾æ•°æ®æœ€å¸¸ç”¨çš„ï¼Œå¯ä»¥çµæ´»çš„æè¿°å„ç§å›¾æ¨¡å¼ï¼Œä½†æ˜¯å®ƒä¾èµ–[ç´¢å¼•](https://docs.nebula-graph.com.cn/3.2.1/2.quick-start/4.nebula-graph-crud/#_12)å»åŒ¹é… NebulaGraph ä¸­çš„æ•°æ®æ¨¡å‹ï¼Œæ€§èƒ½ä¹Ÿè¿˜éœ€è¦è°ƒä¼˜ã€‚

7. 



> ğŸŒ¶**æ³¨æ„**

æ— å±æ€§ç´¢å¼•çš„æ—¶å€™ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šæ¡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ•°æ®æ‰«æçš„sampleä¸‹æ¨å»æ‰«å¾— limit çš„æ•°æ®

è€Œå¸¦æœ‰`filter`æ¡ä»¶æ—¶ï¼Œéœ€è¦å…¨æ‰«æ‰è¡Œï¼Œè¿™ä¸ªæƒ…å†µåœ¨nebulaé‡Œæ˜¯è¢«ç¦æ­¢çš„ï¼Œéœ€è¦åˆ›å»ºè¿™ä¸ªtagä¸Šçš„ç´¢å¼•æ‰èƒ½æŸ¥è¯¢

```sql
# åœ¨ Tag player çš„ name å±æ€§å’Œ Edge type belong_to ä¸Šåˆ›å»ºç´¢å¼•
CREATE TAG INDEX IF NOT EXISTS name ON player(name(20));
CREATE EDGE INDEX IF NOT EXISTS belong_to_index on belong_to();
# é‡å»ºç´¢å¼•ä½¿å…¶ç”Ÿæ•ˆ
REBUILD EDGE INDEX name;
REBUILD EDGE INDEX belong_to_index;
# å¼€å§‹æŸ¥è¯¢
MATCH ()<-[e:belong_to]-() 
WHERE e.industry_name=='æ°´åŠ›å‘ç”µ'
RETURN e
LIMIT 3;
```



## å›¾æ¨¡å¼

æ¨¡å¼(pattern)å’Œå›¾æ¨¡å¼åŒ¹é…ï¼Œæ˜¯å›¾æŸ¥è¯¢è¯­è¨€çš„æ ¸å¿ƒåŠŸèƒ½

> å•ç‚¹æ¨¡å¼

```sql
(a)
```

ç¤ºä¾‹ä¸ºä¸€ä¸ªç®€å•çš„æ¨¡å¼ï¼Œæè¿°äº†å•ä¸ªç‚¹ï¼Œå¹¶ä½¿ç”¨å˜é‡`a`å‘½åè¯¥ç‚¹

> å¤šç‚¹å…³è”æ¨¡å¼

å¤šä¸ªç‚¹é€šè¿‡è¾¹ç›¸è¿æ˜¯å¸¸è§çš„ç»“æ„ï¼Œæ¨¡å¼ç”¨ç®­å¤´æ¥æè¿°ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è¾¹ã€‚ä¾‹å¦‚ï¼š

```sql
(a)-[]->(b)
```

ç¤ºä¾‹ä¸ºä¸€ä¸ªç®€å•çš„æ•°æ®ç»“æ„ï¼šä¸¤ä¸ªç‚¹å’Œä¸€æ¡è¿æ¥ä¸¤ä¸ªç‚¹çš„è¾¹ï¼Œä¸¤ä¸ªç‚¹åˆ†åˆ«ä¸º`a`å’Œ`b`ï¼Œè¾¹æ˜¯æœ‰æ–¹å‘çš„ï¼Œä»`a`åˆ°`b`

è¿™ç§æè¿°ç‚¹å’Œè¾¹çš„æ–¹å¼å¯ä»¥æ‰©å±•åˆ°ä»»æ„æ•°é‡çš„ç‚¹å’Œè¾¹ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[]->(b)<-[]-(c)
```

è¿™æ ·çš„ä¸€ç³»åˆ—ç‚¹å’Œè¾¹ç§°ä¸º`è·¯å¾„`(path)

åªæœ‰åœ¨æ¶‰åŠæŸä¸ªç‚¹æ—¶ï¼Œæ‰éœ€è¦å‘½åè¿™ä¸ªç‚¹ã€‚å¦‚æœä¸æ¶‰åŠè¿™ä¸ªç‚¹ï¼Œåˆ™å¯ä»¥çœç•¥åç§°ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[]->()<-[]-(c)
```

> Tagæ¨¡å¼

nGQL ä¸­çš„`Tag`æ¦‚å¿µä¸ openCypher ä¸­çš„`Label`æœ‰ä¸€äº›ä¸åŒã€‚ä¾‹å¦‚ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ª`Tag`ä¹‹åæ‰èƒ½ä½¿ç”¨å®ƒï¼Œè€Œä¸”`Tag`è¿˜å®šä¹‰äº†å±æ€§çš„ç±»å‹

æ¨¡å¼é™¤äº†ç®€å•åœ°æè¿°å›¾ä¸­çš„ç‚¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æè¿°ç‚¹çš„ Tagã€‚ä¾‹å¦‚ï¼š

```sql
(a:User)-[]->(b)
```

æ¨¡å¼ä¹Ÿå¯ä»¥æè¿°æœ‰å¤šä¸ª Tag çš„ç‚¹ï¼Œä¾‹å¦‚ï¼š

```sql
(a:User:Admin)-[]->(b)
```

> å±æ€§æ¨¡å¼

ç‚¹å’Œè¾¹æ˜¯å›¾çš„åŸºæœ¬ç»“æ„ã€‚nGQL åœ¨è¿™ä¸¤ç§ç»“æ„ä¸Šéƒ½å¯ä»¥å¢åŠ å±æ€§ï¼Œæ–¹ä¾¿å®ç°æ›´ä¸°å¯Œçš„æ¨¡å‹ã€‚

åœ¨æ¨¡å¼ä¸­ï¼Œå±æ€§çš„è¡¨ç¤ºæ–¹å¼ä¸ºï¼šç”¨èŠ±æ‹¬å·æ‹¬èµ·ä¸€äº›é”®å€¼å¯¹ï¼Œç”¨è‹±æ–‡é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ä¸€ä¸ªç‚¹æœ‰ä¸¤ä¸ªå±æ€§ï¼š

```sql
(a {name: 'Andres', sport: 'Brazilian Ju-Jitsu'})
```

åœ¨è¿™ä¸ªç‚¹ä¸Šå¯ä»¥æœ‰ä¸€æ¡è¾¹æ˜¯ï¼š

```sql
(a)-[{blocked: false}]->(b)
```

> è¾¹æ¨¡å¼

æè¿°ä¸€æ¡è¾¹æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç®­å¤´è¿æ¥ä¸¤ä¸ªç‚¹ã€‚

å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼æè¿°è¾¹ä»¥åŠå®ƒçš„æ–¹å‘æ€§ã€‚å¦‚æœä¸å…³å¿ƒè¾¹çš„æ–¹å‘ï¼Œå¯ä»¥çœç•¥ç®­å¤´ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[]-(b)
```

å’Œç‚¹ä¸€æ ·ï¼Œè¾¹ä¹Ÿå¯ä»¥å‘½åã€‚ä¸€å¯¹æ–¹æ‹¬å·ç”¨äºåˆ†éš”ç®­å¤´ï¼Œå˜é‡æ”¾åœ¨ä¸¤è€…ä¹‹é—´ã€‚ä¾‹å¦‚ï¼š

```sql
(a)-[r]->(b)
```

å’Œç‚¹ä¸Šçš„ Tag ä¸€æ ·ï¼Œè¾¹ä¹Ÿå¯ä»¥æœ‰ç±»å‹ã€‚æè¿°è¾¹çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[r:REL_TYPE]->(b)
```

å’Œç‚¹ä¸Šçš„ Tag ä¸åŒï¼Œä¸€æ¡è¾¹åªèƒ½æœ‰ä¸€ç§ Edge typeã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³æè¿°å¤šä¸ªå¯é€‰ Edge typeï¼Œå¯ä»¥ç”¨ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰å°†å¯é€‰å€¼åˆ†å¼€ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[r:TYPE1|TYPE2]->(b)
```

å’Œç‚¹ä¸€æ ·ï¼Œè¾¹çš„åç§°å¯ä»¥çœç•¥ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[:REL_TYPE]->(b)
```

> å˜é•¿æ¨¡å¼

åœ¨å›¾ä¸­æŒ‡å®šè¾¹çš„é•¿åº¦æ¥æè¿°å¤šæ¡è¾¹ï¼ˆä»¥åŠä¸­é—´çš„ç‚¹ï¼‰ç»„æˆçš„ä¸€æ¡é•¿è·¯å¾„ï¼Œä¸éœ€è¦ä½¿ç”¨å¤šä¸ªç‚¹å’Œè¾¹æ¥æè¿°ã€‚ä¾‹å¦‚ï¼š

```sql
(a)-[*2]->(b)
```

è¯¥æ¨¡å¼æè¿°äº† 3 ç‚¹ 2 è¾¹ç»„æˆçš„å›¾ï¼Œå®ƒä»¬éƒ½åœ¨ä¸€æ¡è·¯å¾„ä¸Šï¼ˆé•¿åº¦ä¸º 2ï¼‰ï¼Œç­‰ä»·äºï¼š

```sql
(a)-[]->()-[]->(b)
```

ä¹Ÿå¯ä»¥æŒ‡å®šé•¿åº¦èŒƒå›´ï¼Œè¿™æ ·çš„è¾¹æ¨¡å¼ç§°ä¸º`variable-length edges`ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[*3..5]->(b)
```

`*3..5`è¡¨ç¤ºæœ€å°é•¿åº¦ä¸º 3ï¼Œæœ€å¤§é•¿åº¦ä¸º 5ã€‚

è¯¥æ¨¡å¼æè¿°äº† 4 ç‚¹ 3 è¾¹ã€5 ç‚¹ 4 è¾¹æˆ– 6 ç‚¹ 5 è¾¹ç»„æˆçš„å›¾ã€‚

ä¹Ÿå¯ä»¥å¿½ç•¥æœ€å°é•¿åº¦ï¼ŒåªæŒ‡å®šæœ€å¤§é•¿åº¦ï¼Œä¾‹å¦‚ï¼š

```sql
(a)-[*..5]->(b)
```

å¿…é¡»æŒ‡å®šæœ€å¤§é•¿åº¦ï¼Œ**ä¸æ”¯æŒ**ä»…æŒ‡å®šæœ€å°é•¿åº¦ï¼ˆ`(a)-[*3..]->(b)`ï¼‰æˆ–éƒ½ä¸æŒ‡å®šï¼ˆ`(a)-[*]->(b)`ï¼‰ã€‚

> è·¯å¾„å˜é‡

ä¸€ç³»åˆ—è¿æ¥çš„ç‚¹å’Œè¾¹ç§°ä¸º`è·¯å¾„`ã€‚nGQL å…è®¸ä½¿ç”¨å˜é‡æ¥å‘½åè·¯å¾„ï¼Œä¾‹å¦‚ï¼š

```sql
p = (a)-[*3..5]->(b)
```

å¯ä»¥åœ¨ MATCH è¯­å¥ä¸­ä½¿ç”¨è·¯å¾„å˜é‡

> æ³¨é‡Š

æ”¯æŒå››ç§æ³¨é‡Šæ–¹å¼ï¼š`#`ã€`//`ã€`/* */`

nGQL è¯­å¥ä¸­çš„åæ–œçº¿ï¼ˆ\ï¼‰ä»£è¡¨æ¢è¡Œ

> æ•°æ®ç±»å‹

å­—ç¬¦ä¸²çš„è¡¨ç¤ºæ–¹å¼ä¸ºç”¨åŒå¼•å·æˆ–å•å¼•å·åŒ…è£¹ï¼Œä¾‹å¦‚`"Hello, Cooper"`æˆ–`'Hello, Cooper'`

æ—¥æœŸå’Œæ—¶é—´çš„ç±»å‹ï¼ŒåŒ…æ‹¬`DATE`ã€`TIME`ã€`DATETIME`ã€`TIMESTAMP`å’Œ`DURATION`

````sql
nebula> RETURN DATE({year:-123, month:12, day:3});
+------------------------------------+
| date({year:-(123),month:12,day:3}) |
+------------------------------------+
| -123-12-03                         |
+------------------------------------+
nebula> RETURN DATE("23333");
+---------------+
| date("23333") |
+---------------+
| 23333-01-01   |
+---------------+

# ä¼ å…¥å½“å‰æ—¶é—´ã€‚
nebula> RETURN timestamp();
+-------------+
| timestamp() |
+-------------+
| 1625469277  |
+-------------+

# ä¼ å…¥æŒ‡å®šæ—¶é—´ã€‚
nebula> RETURN timestamp("2022-01-05T06:18:43");
+----------------------------------+
| timestamp("2022-01-05T06:18:43") |
+----------------------------------+
| 1641363523                       |
+----------------------------------+
````

`date()`æ”¯æŒçš„å±æ€§åç§°åŒ…æ‹¬`year`ã€`month`å’Œ`day`ã€‚`date()`æ”¯æŒè¾“å…¥`YYYY`ã€`YYYY-MM`æˆ–`YYYY-MM-DD`ï¼Œæœªè¾“å…¥çš„æœˆä»½æˆ–æ—¥æœŸé»˜è®¤ä¸º`01`

`time()`æ”¯æŒçš„å±æ€§åç§°åŒ…æ‹¬`hour`ã€`minute`å’Œ`second`

`datetime()`æ”¯æŒçš„å±æ€§åç§°åŒ…æ‹¬`year`ã€`month`ã€`day`ã€`hour`ã€`minute`å’Œ`second`

åˆ—è¡¨ï¼ˆListï¼‰æ˜¯å¤åˆæ•°æ®ç±»å‹ï¼Œä¸€ä¸ªåˆ—è¡¨æ˜¯ä¸€ç»„å…ƒç´ çš„åºåˆ—ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ åœ¨åºåˆ—ä¸­çš„ä½ç½®è®¿é—®åˆ—è¡¨ä¸­çš„å…ƒç´ 

nGQL çš„ä¸‹æ ‡æ”¯æŒä»å‰å¾€åæŸ¥è¯¢ï¼Œä» 0 å¼€å§‹ï¼Œ0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ1 è¡¨ç¤ºç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ï¼›ä¹Ÿæ”¯æŒä»åå¾€å‰æŸ¥è¯¢ï¼Œä»-1 å¼€å§‹ï¼Œ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚

- [M]ï¼šè¡¨ç¤ºä¸‹æ ‡ä¸º M çš„å…ƒç´ ã€‚
- [M..N]ï¼šè¡¨ç¤º`M â‰¤ ä¸‹æ ‡ ï¼œ N`çš„å…ƒç´ ã€‚`N`ä¸º 0 æ—¶ï¼Œè¿”å›ä¸ºç©ºã€‚
- [M..]ï¼šè¡¨ç¤º`M â‰¤ ä¸‹æ ‡`çš„å…ƒç´ ã€‚
- [..N]ï¼šè¡¨ç¤º`ä¸‹æ ‡ ï¼œ N`çš„å…ƒç´ ã€‚`N`ä¸º 0 æ—¶ï¼Œè¿”å›ä¸ºç©ºã€‚

## å¯è§†åŒ–

NebulaGraph Studioï¼ˆç®€ç§° Studioï¼‰æ˜¯ä¸€æ¬¾å¯ä»¥é€šè¿‡ Web è®¿é—®çš„å¼€æºå›¾æ•°æ®åº“å¯è§†åŒ–å·¥å…·ï¼Œæ­é… [NebulaGraph](https://docs.nebula-graph.com.cn/3.2.1/) å†…æ ¸ä½¿ç”¨ï¼Œæä¾›æ„å›¾ã€æ•°æ®å¯¼å…¥ã€ç¼–å†™ nGQL æŸ¥è¯¢ç­‰ä¸€ç«™å¼æœåŠ¡ã€‚

> å‰ææ¡ä»¶[Â¶](https://docs.nebula-graph.com.cn/3.2.1/nebula-studio/deploy-connect/st-ug-deploy/#_1)

åœ¨éƒ¨ç½² RPM ç‰ˆ Studio ä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼š

- NebulaGraph æœåŠ¡å·²ç»éƒ¨ç½²å¹¶å¯åŠ¨ã€‚è¯¦ç»†ä¿¡æ¯ï¼Œå‚è€ƒ [NebulaGraph å®‰è£…éƒ¨ç½²](https://docs.nebula-graph.com.cn/3.2.1/4.deployment-and-installation/1.resource-preparations/)

- ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆä¸º CentOS ï¼Œå·²å®‰è£… lsof

- ç¡®ä¿ä»¥ä¸‹ç«¯å£æœªè¢«å ç”¨ï¼Œ`7001`æ˜¯Studio æä¾› web æœåŠ¡ä½¿ç”¨çš„



ä»å®˜ç½‘ä¸‹è½½[nebula-graph-studio-3.4.1.x86_64.rpm](https://oss-cdn.nebula-graph.com.cn/nebula-graph-studio/3.4.1/nebula-graph-studio-3.4.1.x86_64.rpm)ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…åˆ°æŒ‡å®šè·¯å¾„

```sh
sudo rpm -i nebula-graph-studio-3.4.1.x86_64.rpm --prefix=<path> 
```

å®‰è£…å®Œï¼Œè‡ªåŠ¨ä¼šå¯åŠ¨ï¼Œå½“å±å¹•è¿”å›ä»¥ä¸‹ä¿¡æ¯æ—¶ï¼Œè¡¨ç¤º PRM ç‰ˆ Studio å·²ç»æˆåŠŸå¯åŠ¨ã€‚

```sh
Start installing NebulaGraph Studio now...
NebulaGraph Studio has been installed.
NebulaGraph Studio started automatically.
```

å¯åŠ¨æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ `http://<ip address>:7001`

**æ³¨æ„**: hostå¤„å¡«å†™ä¸º `ip:port`æ ¼å¼

ç”¨æˆ·åå’Œå¯†ç ï¼šæ ¹æ® Nebula Graph çš„èº«ä»½éªŒè¯è®¾ç½®å¡«å†™ç™»å½•è´¦å·å’Œå¯†ç 

- å¦‚æœæœªå¯ç”¨èº«ä»½éªŒè¯ï¼Œå¯ä»¥å¡«å†™é»˜è®¤ç”¨æˆ·å `root` å’Œä»»æ„å¯†ç ã€‚
- å¦‚æœå·²å¯ç”¨èº«ä»½éªŒè¯ï¼Œä½†æ˜¯æœªåˆ›å»ºè´¦å·ä¿¡æ¯ï¼Œç”¨æˆ·åªèƒ½ä»¥ GOD è§’è‰²ç™»å½•ï¼Œå¿…é¡»å¡«å†™ `root` åŠå¯¹åº”çš„å¯†ç  `nebula`ã€‚
- å¦‚æœå·²å¯ç”¨èº«ä»½éªŒè¯ï¼ŒåŒæ—¶åˆåˆ›å»ºäº†ä¸åŒçš„ç”¨æˆ·å¹¶åˆ†é…äº†è§’è‰²ï¼Œä¸åŒè§’è‰²çš„ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„è´¦å·å’Œå¯†ç ç™»å½•ã€‚

å¦‚æœåœ¨æµè§ˆå™¨çª—å£ä¸­èƒ½çœ‹åˆ°ä»¥ä¸‹ç™»å½•ç•Œé¢ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸéƒ¨ç½²å¹¶å¯åŠ¨ Studio

> å¼‚å¸¸å¤„ç†[Â¶](https://docs.nebula-graph.com.cn/3.2.1/nebula-studio/deploy-connect/st-ug-deploy/#_4)

å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­è‡ªåŠ¨å¯åŠ¨å¤±è´¥æˆ–æ˜¯éœ€è¦æ‰‹åŠ¨å¯åŠ¨æˆ–åœæ­¢æœåŠ¡ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

- æ‰‹åŠ¨å¯åŠ¨æœåŠ¡

  ```sh
  bash /usr/local/nebula-graph-studio/scripts/rpm/start.sh
  ```

- æ‰‹åŠ¨åœæ­¢æœåŠ¡

  ```sh
  bash /usr/local/nebula-graph-studio/scripts/rpm/stop.sh
  ```

å¦‚æœå¯åŠ¨æœåŠ¡æ—¶é‡åˆ°æŠ¥é”™æŠ¥é”™ `ERROR: bind EADDRINUSE 0.0.0.0:7001`ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£ 7001 æ˜¯å¦è¢«å ç”¨ã€‚

```sh
lsof -i:7001
```

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¸”æ— æ³•ç»“æŸè¯¥ç«¯å£ä¸Šè¿›ç¨‹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹ Studio æœåŠ¡å¯åŠ¨ç«¯å£ï¼Œå¹¶é‡æ–°å¯åŠ¨æœåŠ¡ã€‚

```sh
//ä¿®æ”¹ studio æœåŠ¡å¯åŠ¨ç«¯å£
vi etc/studio-api.yam
//ä¿®æ”¹
Port: 7001 // ä¿®æ”¹è¿™ä¸ªç«¯å£å·ï¼Œæ”¹æˆä»»æ„ä¸€ä¸ªå½“å‰å¯ç”¨çš„å³å¯
//é‡å¯æœåŠ¡
systemctl restart nebula-graph-studio.service
```



## é›†ç¾¤ç›‘æ§

[`NebulaGraph Dashboard`](https://docs.nebula-graph.com.cn/3.2.1/nebula-dashboard/1.what-is-dashboard/)(ç®€ç§°Dashboard)æ˜¯ä¸€æ¬¾ç”¨äºç›‘æ§NebulaGraphé›†ç¾¤ä¸­æœºå™¨å’ŒæœåŠ¡çŠ¶æ€çš„å¯è§†åŒ–å·¥å…·

## æ•°æ®å¯¼å…¥

> [Nebula Importer æ•°æ®å¯¼å…¥å®è·µ](https://baijiahao.baidu.com/s?id=1737412299821419025&wfr=spider&for=pc)

Nebula ç›®å‰ä½œä¸ºè¾ƒä¸ºæˆç†Ÿçš„äº§å“ï¼Œå·²ç»æœ‰ç€å¾ˆä¸°å¯Œçš„ç”Ÿæ€ã€‚æ•°æ®å¯¼å…¥çš„ç»´åº¦è€Œè¨€å°±å·²ç»æä¾›äº†å¤šç§é€‰æ‹©ã€‚æœ‰å¤§è€Œå…¨çš„Nebula Exchangeï¼Œå°è€Œç²¾ç®€çš„Nebula Importer, è¿˜æœ‰ä¸º Spark / Flink å¼•æ“æä¾›çš„Nebula Spark Connector å’Œ Nebula Flink Connectorã€‚

ä½¿ç”¨åœºæ™¯ä»‹ç»ï¼š

- Nebula Exchange

- - éœ€è¦å°†æ¥è‡ª Kafkaã€Pulsar å¹³å°çš„æµå¼æ•°æ®, å¯¼å…¥ Nebula Graph æ•°æ®åº“
  - éœ€è¦ä»å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰æˆ–è€…åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ HDFSï¼‰ä¸­è¯»å–æ‰¹å¼æ•°æ®
  - éœ€è¦å°†å¤§æ‰¹é‡æ•°æ®ç”Ÿæˆ Nebula Graph èƒ½è¯†åˆ«çš„ SST æ–‡ä»¶

- Nebula Importer

- - Importer é€‚ç”¨äºå°†æœ¬åœ° CSV æ–‡ä»¶çš„å†…å®¹å¯¼å…¥è‡³ Nebula Graph ä¸­

- Nebula Spark Connector:

- - åœ¨ä¸åŒçš„ Nebula Graph é›†ç¾¤ä¹‹é—´è¿ç§»æ•°æ®
  - åœ¨åŒä¸€ä¸ª Nebula Graph é›†ç¾¤å†…ä¸åŒå›¾ç©ºé—´ä¹‹é—´è¿ç§»æ•°æ®
  - Nebula Graph ä¸å…¶ä»–æ•°æ®æºä¹‹é—´è¿ç§»æ•°æ®
  - ç»“åˆ Nebula Algorithm è¿›è¡Œå›¾è®¡ç®—

- Nebula Flink Connector

- - åœ¨ä¸åŒçš„ Nebula Graph é›†ç¾¤ä¹‹é—´è¿ç§»æ•°æ®
  - åœ¨åŒä¸€ä¸ª Nebula Graph é›†ç¾¤å†…ä¸åŒå›¾ç©ºé—´ä¹‹é—´è¿ç§»æ•°æ®
  - Nebula Graph ä¸å…¶ä»–æ•°æ®æºä¹‹é—´è¿ç§»æ•°æ®

æ€»ä½“æ¥è¯´ï¼ŒExchange å¤§è€Œå…¨ï¼Œå¯ä»¥å’Œå¤§éƒ¨åˆ†çš„å­˜å‚¨å¼•æ“ç»“åˆï¼Œå¯¼å…¥åˆ° Nebula ä¸­ï¼Œä½†æ˜¯éœ€è¦éƒ¨ç½²Spark ç¯å¢ƒã€‚

Importer ä½¿ç”¨ç®€å•ï¼Œæ‰€éœ€ä¾èµ–è¾ƒå°‘ï¼Œä½†éœ€è¦è‡ªå·±æå‰ç”Ÿæˆæ•°æ®æ–‡ä»¶ï¼Œé…ç½®å¥½ schema ä¸€åŠ³æ°¸é€¸ï¼Œä½†æ˜¯ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œé€‚åˆæ•°æ®é‡ä¸­ç­‰ã€‚

Spark / Flink Connector éœ€è¦å’Œæµæ•°æ®ç»“åˆã€‚

ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„å·¥å…·ï¼Œå¦‚æœä½œä¸ºæ–°äººä½¿ç”¨ Nebula åœ¨å¯¼å…¥æ•°æ®æ—¶ï¼Œå»ºè®®ä½¿ç”¨ Nebula Importer å·¥å…·ï¼Œç®€å•å¿«é€Ÿä¸Šæ‰‹ã€‚



# k8s

> [k8så®˜ç½‘ä¸­æ–‡æ–‡æ¡£](https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/)
>
> [Kubernetesï¼ˆK8Sï¼‰æ•™ç¨‹](https://k8s.easydoc.net)
>
> [Kubernetes Clusters-ç‹‚ä¹±çš„è´µå…¬å­](https://www.cnblogs.com/cjsblog/p/12050618.html)

## ç®€ä»‹

> Kubernetes (K8S) æ˜¯ä»€ä¹ˆ

å®ƒæ˜¯ä¸€ä¸ªä¸º **å®¹å™¨åŒ–** åº”ç”¨æä¾›é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†çš„å¼€æºå·¥å…·ï¼Œç”± Google å¼€å‘

**Kubernetes** è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦çš„å…³ç³»ã€‚ Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®

**ä¸»è¦ç‰¹æ€§ï¼š**

- é«˜å¯ç”¨ï¼Œä¸å®•æœºï¼Œè‡ªåŠ¨ç¾éš¾æ¢å¤
- ç°åº¦æ›´æ–°ï¼Œä¸å½±å“ä¸šåŠ¡æ­£å¸¸è¿è½¬
- ä¸€é”®å›æ»šåˆ°å†å²ç‰ˆæœ¬
- æ–¹ä¾¿çš„ä¼¸ç¼©æ‰©å±•ï¼ˆåº”ç”¨ä¼¸ç¼©ï¼Œæœºå™¨åŠ å‡ï¼‰ã€æä¾›è´Ÿè½½å‡è¡¡
- æœ‰ä¸€ä¸ªå®Œå–„çš„ç”Ÿæ€

> éƒ¨ç½²æ–¹æ¡ˆ

* ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼š

åº”ç”¨ç›´æ¥åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½²ï¼Œæœºå™¨èµ„æºåˆ†é…ä¸å¥½æ§åˆ¶ï¼Œå‡ºç°Bugæ—¶ï¼Œå¯èƒ½æœºå™¨çš„å¤§éƒ¨åˆ†èµ„æºè¢«æŸä¸ªåº”ç”¨å ç”¨ï¼Œå¯¼è‡´å…¶ä»–åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ— æ³•åšåˆ°åº”ç”¨éš”ç¦»

* è™šæ‹Ÿæœºéƒ¨ç½²

åœ¨å•ä¸ªç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯å®Œæ•´ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œæ€§èƒ½æŸè€—å¤§

* å®¹å™¨éƒ¨ç½²

æ‰€æœ‰å®¹å™¨å…±äº«ä¸»æœºçš„ç³»ç»Ÿï¼Œè½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œæ€§èƒ½æŸè€—å°ï¼Œèµ„æºéš”ç¦»ï¼ŒCPUå’Œå†…å­˜å¯æŒ‰éœ€åˆ†é…

![k8så’Œè™šæ‹Ÿæœºæ¯”è¾ƒ](https://pic.hycbook.com/i/hexo/bk_resources/common/6.dockerä½¿ç”¨/k8så’Œè™šæ‹Ÿæœºæ¯”è¾ƒ.webp)

Kubernetes å¯ä»¥ä¸ºä½ æä¾›é›†ä¸­å¼çš„ç®¡ç†é›†ç¾¤æœºå™¨å’Œåº”ç”¨ï¼ŒåŠ æœºå™¨ã€ç‰ˆæœ¬å‡çº§ã€ç‰ˆæœ¬å›æ»šï¼Œé‚£éƒ½æ˜¯ä¸€ä¸ªå‘½ä»¤å°±æå®šçš„äº‹ï¼Œä¸åœæœºçš„ç°åº¦æ›´æ–°ï¼Œç¡®ä¿é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜æ‰©å±•

> é‡è¦æ¦‚å¿µ Pod

è±†èšï¼ŒK8S è°ƒåº¦ã€ç®¡ç†çš„æœ€å°å•ä½ï¼Œä¸€ä¸ª Pod å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ª Pod æœ‰è‡ªå·±çš„è™šæ‹ŸIPã€‚ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ª podï¼Œä¸»èŠ‚ç‚¹ä¼šè€ƒé‡è´Ÿè½½è‡ªåŠ¨è°ƒåº¦ pod åˆ°å“ªä¸ªèŠ‚ç‚¹è¿è¡Œ

![podæ¦‚å¿µ](https://pic.hycbook.com/i/hexo/bk_resources/common/6.dockerä½¿ç”¨/podæ¦‚å¿µ.webp)

> Kubernetes ç»„ä»¶

Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å’Œç®¡ç†å¹³å°ï¼Œç”±å¤šä¸ªç»„ä»¶ç»„æˆã€‚ä¸‹é¢æ˜¯ Kubernetes çš„ä¸€äº›æ ¸å¿ƒç»„ä»¶ï¼š

1. kube-apiserverï¼šä½œä¸º Kubernetes API çš„å‰ç«¯ç»„ä»¶ï¼Œå¤„ç†æ¥è‡ªç”¨æˆ·ã€kubectl å‘½ä»¤è¡Œå·¥å…·ä»¥åŠå…¶ä»–ç»„ä»¶çš„ API è¯·æ±‚ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ etcd ä¸­
2. etcdï¼šæ˜¯ä¸€ä¸ªé«˜åº¦å¯ç”¨ä¸”ä¸€è‡´æ€§çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œç”¨äºä¿å­˜ Kubernetes é›†ç¾¤çš„é…ç½®æ•°æ®ã€å…ƒæ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯
3. kube-schedulerï¼šè´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ Podï¼Œå¹¶æ ¹æ®å¯ç”¨çš„è®¡ç®—èµ„æºã€ç¡¬ä»¶å’Œè½¯ä»¶è¦æ±‚é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œè°ƒåº¦
4. kube-controller-managerï¼šåŒ…å«å¤šä¸ªæ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†é›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œä¾‹å¦‚èŠ‚ç‚¹æ§åˆ¶å™¨ã€å‰¯æœ¬æ§åˆ¶å™¨ã€æœåŠ¡æ§åˆ¶å™¨ç­‰ã€‚å®ƒè´Ÿè´£ä¿æŒæœŸæœ›çŠ¶æ€å’Œå®é™…çŠ¶æ€ä¹‹é—´çš„ä¸€è‡´æ€§
5. kubeletï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»£ç†ç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ï¼Œä¸å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ï¼Œæ¥æ”¶æ¥è‡ª kube-apiserver çš„æŒ‡ä»¤ï¼Œå¹¶ç¡®ä¿å®¹å™¨æŒ‰ç…§æœŸæœ›çŠ¶æ€è¿è¡Œ
6. kube-proxyï¼šè´Ÿè´£ä¸º Service å¯¹è±¡æä¾›ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå°†ç½‘ç»œæµé‡è·¯ç”±åˆ°æ­£ç¡®çš„å®¹å™¨ä¸Š
7. Container Runtimeï¼šKubernetes æ”¯æŒå¤šç§å®¹å™¨è¿è¡Œæ—¶ï¼Œå¦‚ Dockerã€containerdã€CRI-O ç­‰ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†å®¹å™¨
8. kube-dns/corednsï¼šæä¾›é›†ç¾¤å†… DNS æœåŠ¡ï¼Œç”¨äºè§£æ Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡åç§°
9. Dashboardï¼šæä¾›å¯è§†åŒ–çš„ Kubernetes é›†ç¾¤ç®¡ç†ç•Œé¢ï¼Œç”¨äºæŸ¥çœ‹å’Œæ“ä½œé›†ç¾¤ä¸­çš„èµ„æº

é™¤äº†è¿™äº›æ ¸å¿ƒç»„ä»¶ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„è¾…åŠ©ç»„ä»¶å’Œæ’ä»¶ï¼Œå¦‚Ingress Controllerï¼ˆç”¨äºç®¡ç†å…¥å£æµé‡ï¼‰ã€Heapsterï¼ˆç”¨äºé›†ç¾¤ç›‘æ§å’Œæ€§èƒ½åˆ†æï¼‰ã€Prometheusï¼ˆç”¨äºæŒ‡æ ‡æ”¶é›†å’Œç›‘æ§ï¼‰ã€Fluentdï¼ˆç”¨äºæ—¥å¿—æ”¶é›†å’Œèšåˆï¼‰ç­‰ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©å®‰è£…å’Œé…ç½®

![k8sé›†ç¾¤](https://pic.hycbook.com/i/hexo/bk_resources/common/6.dockerä½¿ç”¨/k8sé›†ç¾¤.webp)

## å®‰è£…å’Œéƒ¨ç½²

å ä½...

